<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Transaction</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Transactions}
\label{sec:transactions}

</a><a id="50" class="Markup">\begin{code}[hide]</a>
<a id="69" class="Symbol">{-#</a> <a id="73" class="Keyword">OPTIONS</a> <a id="81" class="Pragma">--safe</a> <a id="88" class="Symbol">#-}</a>
<a id="92" class="Comment">--------------------------------------------------------------------------------</a>
<a id="173" class="Comment">-- NOTE: Everything in this module is part of TransactionStructure</a>
<a id="240" class="Comment">--------------------------------------------------------------------------------</a>
<a id="321" class="Keyword">module</a> <a id="328" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a> <a id="347" class="Keyword">where</a>

<a id="354" class="Keyword">import</a> <a id="361" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="377" class="Symbol">as</a> <a id="380" class="Module">M</a>

<a id="383" class="Keyword">open</a> <a id="388" class="Keyword">import</a> <a id="395" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="411" class="Keyword">open</a> <a id="416" class="Keyword">import</a> <a id="423" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="437" class="Keyword">open</a> <a id="442" class="Keyword">import</a> <a id="449" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="Ledger.GovStructure.html" class="Module">Ledger.GovStructure</a>
<a id="494" class="Keyword">import</a> <a id="501" href="Ledger.PParams.html" class="Module">Ledger.PParams</a>
<a id="516" class="Keyword">import</a> <a id="523" href="Ledger.Script.html" class="Module">Ledger.Script</a>
<a id="537" class="Keyword">import</a> <a id="544" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a>
<a id="569" class="Keyword">import</a> <a id="576" href="Ledger.Deleg.html" class="Module">Ledger.Deleg</a>
<a id="589" class="Keyword">import</a> <a id="596" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a>
<a id="616" class="Keyword">import</a> <a id="623" href="Ledger.Address.html" class="Module">Ledger.Address</a>


<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>
<a id="672" class="Keyword">open</a> <a id="677" class="Keyword">import</a> <a id="684" href="MyDebugOptions.html" class="Module">MyDebugOptions</a>
<a id="699" class="Keyword">open</a> <a id="704" class="Keyword">import</a> <a id="711" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="738" class="Keyword">using</a> <a id="744" class="Symbol">(</a><a id="745" href="Relation.Nullary.Decidable.Core.html#3274" class="Function Operator">⌊_⌋</a><a id="748" class="Symbol">)</a>

<a id="751" class="Keyword">data</a> <a id="Tag"></a><a id="756" href="Ledger.Transaction.html#756" class="Datatype">Tag</a> <a id="760" class="Symbol">:</a> <a id="762" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="766" class="Keyword">where</a>
  <a id="Tag.Spend"></a><a id="774" href="Ledger.Transaction.html#774" class="InductiveConstructor">Spend</a> <a id="Tag.Mint"></a><a id="780" href="Ledger.Transaction.html#780" class="InductiveConstructor">Mint</a> <a id="Tag.Cert"></a><a id="785" href="Ledger.Transaction.html#785" class="InductiveConstructor">Cert</a> <a id="Tag.Rewrd"></a><a id="790" href="Ledger.Transaction.html#790" class="InductiveConstructor">Rewrd</a> <a id="796" class="Symbol">:</a> <a id="798" href="Ledger.Transaction.html#756" class="Datatype">Tag</a>
<a id="802" class="Keyword">unquoteDecl</a> <a id="DecEq-Tag"></a><a id="814" href="Ledger.Transaction.html#814" class="Function">DecEq-Tag</a> <a id="824" class="Symbol">=</a> <a id="826" href="Tactic.Derive.DecEq.html#3471" class="Function">derive-DecEq</a> <a id="839" class="Symbol">((</a><a id="841" class="Keyword">quote</a> <a id="847" href="Ledger.Transaction.html#756" class="Datatype">Tag</a> <a id="851" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="853" href="Ledger.Transaction.html#814" class="Function">DecEq-Tag</a><a id="862" class="Symbol">)</a> <a id="864" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="866" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="868" class="Symbol">)</a>

<a id="871" class="Keyword">record</a> <a id="TransactionStructure"></a><a id="878" href="Ledger.Transaction.html#878" class="Record">TransactionStructure</a> <a id="899" class="Symbol">:</a> <a id="901" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="906" class="Keyword">where</a>
  <a id="914" class="Keyword">field</a>
<a id="920" class="Markup">\end{code}</a><a id="930" class="Background">

Transactions are defined in Figure~\ref{fig:defs:utxo-shelley}. A
transaction is made up of a transaction body, a collection of
witnesses and some optional auxiliary data. Some key ingredients in
the transaction body are:

\begin{itemize}
  \item A set of transaction inputs, each of which identifies an output from a previous transaction.
    A transaction input consists of a transaction id and an index to uniquely identify the output.
  \item An indexed collection of transaction outputs.
    The \TxOut type is an address paired with a coin value.
  \item A transaction fee. This value will be added to the fee pot.
  \item The size and the hash of the serialized form of the transaction that was included in the block.
\end{itemize}

\begin{figure*}[h]
\emph{Abstract types}
\AgdaTarget{Ix, TxId, Epoch, AuxiliaryData}
</a><a id="1757" class="Markup">\begin{code}</a>
        <a id="TransactionStructure.Ix"></a><a id="1778" href="Ledger.Transaction.html#1778" class="Field">Ix</a> <a id="TransactionStructure.TxId"></a><a id="1781" href="Ledger.Transaction.html#1781" class="Field">TxId</a> <a id="TransactionStructure.AuxiliaryData"></a><a id="1786" href="Ledger.Transaction.html#1786" class="Field">AuxiliaryData</a> <a id="1800" class="Symbol">:</a> <a id="1802" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1806" class="Markup">\end{code}</a><a id="1816" class="Background">
</a><a id="1817" class="Markup">\begin{code}[hide]</a>
        <a id="1844" class="Symbol">⦃</a> <a id="TransactionStructure.DecEq-Ix"></a><a id="1846" href="Ledger.Transaction.html#1846" class="Field">DecEq-Ix</a>   <a id="1857" class="Symbol">⦄</a> <a id="1859" class="Symbol">:</a> <a id="1861" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1867" href="Ledger.Transaction.html#1778" class="Field">Ix</a>
        <a id="1878" class="Symbol">⦃</a> <a id="TransactionStructure.DecEq-TxId"></a><a id="1880" href="Ledger.Transaction.html#1880" class="Field">DecEq-TxId</a> <a id="1891" class="Symbol">⦄</a> <a id="1893" class="Symbol">:</a> <a id="1895" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1901" href="Ledger.Transaction.html#1781" class="Field">TxId</a>
        <a id="TransactionStructure.adHashingScheme"></a><a id="1914" href="Ledger.Transaction.html#1914" class="Field">adHashingScheme</a> <a id="1930" class="Symbol">:</a> <a id="1932" href="Ledger.Crypto.html#152" class="Record">isHashableSet</a> <a id="1946" href="Ledger.Transaction.html#1786" class="Field">AuxiliaryData</a>
  <a id="1962" class="Keyword">open</a> <a id="1967" href="Ledger.Crypto.html#152" class="Module">isHashableSet</a> <a id="1981" href="Ledger.Transaction.html#1914" class="Field">adHashingScheme</a> <a id="1997" class="Keyword">renaming</a> <a id="2006" class="Symbol">(</a><a id="2007" href="Ledger.Crypto.html#227" class="Field">THash</a> <a id="2013" class="Symbol">to</a> <a id="2016" class="Field">ADHash</a><a id="2022" class="Symbol">)</a> <a id="2024" class="Keyword">public</a>

  <a id="2034" class="Keyword">field</a> <a id="TransactionStructure.globalConstants"></a><a id="2040" href="Ledger.Transaction.html#2040" class="Field">globalConstants</a> <a id="2056" class="Symbol">:</a> <a id="2058" class="Symbol">_</a>
  <a id="2062" class="Keyword">open</a> <a id="2067" href="Ledger.Epoch.html#1533" class="Module">GlobalConstants</a> <a id="2083" href="Ledger.Transaction.html#2040" class="Field">globalConstants</a> <a id="2099" class="Keyword">public</a>

  <a id="2109" class="Keyword">field</a> <a id="TransactionStructure.crypto"></a><a id="2115" href="Ledger.Transaction.html#2115" class="Field">crypto</a> <a id="2122" class="Symbol">:</a> <a id="2124" class="Symbol">_</a>
  <a id="2128" class="Keyword">open</a> <a id="2133" href="Ledger.Crypto.html#1473" class="Module">Crypto</a> <a id="2140" href="Ledger.Transaction.html#2115" class="Field">crypto</a> <a id="2147" class="Keyword">public</a>
  <a id="2156" class="Keyword">open</a> <a id="2161" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a> <a id="2181" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="2192" class="Keyword">public</a>
  <a id="2201" class="Keyword">open</a> <a id="2206" href="Ledger.Address.html" class="Module">Ledger.Address</a> <a id="2221" href="Ledger.Epoch.html#1571" class="Function">Network</a> <a id="2229" href="Ledger.Crypto.html#1698" class="Function">KeyHash</a> <a id="2237" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="2248" class="Keyword">public</a>

  <a id="2258" class="Keyword">field</a> <a id="TransactionStructure.epochStructure"></a><a id="2264" href="Ledger.Transaction.html#2264" class="Field">epochStructure</a> <a id="2279" class="Symbol">:</a> <a id="2281" class="Symbol">_</a>
  <a id="2285" class="Keyword">open</a> <a id="2290" href="Ledger.Epoch.html#228" class="Module">EpochStructure</a> <a id="2305" href="Ledger.Transaction.html#2264" class="Field">epochStructure</a> <a id="2320" class="Keyword">public</a>
  <a id="2329" class="Keyword">open</a> <a id="2334" href="Ledger.Script.html" class="Module">Ledger.Script</a> <a id="2348" href="Ledger.Transaction.html#2115" class="Field">crypto</a> <a id="2355" href="Ledger.Transaction.html#2264" class="Field">epochStructure</a> <a id="2370" class="Keyword">public</a>

  <a id="2380" class="Keyword">field</a> <a id="TransactionStructure.scriptStructure"></a><a id="2386" href="Ledger.Transaction.html#2386" class="Field">scriptStructure</a> <a id="2402" class="Symbol">:</a> <a id="2404" href="Ledger.Script.html#2326" class="Record">ScriptStructure</a>
  <a id="2422" class="Keyword">open</a> <a id="2427" href="Ledger.Script.html#2326" class="Module">ScriptStructure</a> <a id="2443" href="Ledger.Transaction.html#2386" class="Field">scriptStructure</a> <a id="2459" class="Keyword">public</a>
  <a id="2468" class="Keyword">open</a> <a id="2473" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="2488" href="Ledger.Transaction.html#2115" class="Field">crypto</a> <a id="2495" href="Ledger.Transaction.html#2264" class="Field">epochStructure</a> <a id="2510" href="Ledger.Transaction.html#2386" class="Field">scriptStructure</a> <a id="2526" class="Keyword">public</a>

  <a id="2536" class="Keyword">field</a> <a id="TransactionStructure.govParams"></a><a id="2542" href="Ledger.Transaction.html#2542" class="Field">govParams</a> <a id="2552" class="Symbol">:</a> <a id="2554" class="Symbol">_</a>
  <a id="2558" class="Keyword">open</a> <a id="2563" href="Ledger.PParams.html#5610" class="Module">GovParams</a> <a id="2573" href="Ledger.Transaction.html#2542" class="Field">govParams</a> <a id="2583" class="Keyword">public</a>

  <a id="2593" class="Keyword">field</a> <a id="TransactionStructure.tokenAlgebra"></a><a id="2599" href="Ledger.Transaction.html#2599" class="Field">tokenAlgebra</a> <a id="2612" class="Symbol">:</a> <a id="2614" href="Ledger.TokenAlgebra.html#499" class="Record">TokenAlgebra</a>
  <a id="2629" class="Keyword">open</a> <a id="2634" href="Ledger.TokenAlgebra.html#499" class="Module">TokenAlgebra</a> <a id="2647" href="Ledger.Transaction.html#2599" class="Field">tokenAlgebra</a> <a id="2660" class="Keyword">public</a>

  <a id="2670" class="Keyword">field</a> <a id="TransactionStructure.txidBytes"></a><a id="2676" href="Ledger.Transaction.html#2676" class="Field">txidBytes</a> <a id="2686" class="Symbol">:</a> <a id="2688" href="Ledger.Transaction.html#1781" class="Field">TxId</a> <a id="2693" class="Symbol">→</a> <a id="2695" href="Ledger.Crypto.html#734" class="Function">Ser</a>
        <a id="TransactionStructure.networkId"></a><a id="2707" href="Ledger.Transaction.html#2707" class="Field">networkId</a> <a id="2717" class="Symbol">:</a> <a id="2719" href="Ledger.Epoch.html#1571" class="Function">Network</a>

  <a id="TransactionStructure.govStructure"></a><a id="2730" href="Ledger.Transaction.html#2730" class="Function">govStructure</a> <a id="2743" class="Symbol">:</a> <a id="2745" href="Ledger.GovStructure.html#194" class="Record">GovStructure</a>
  <a id="2760" href="Ledger.Transaction.html#2730" class="Function">govStructure</a> <a id="2773" class="Symbol">=</a> <a id="2775" class="Keyword">record</a>
    <a id="2786" class="Comment">-- TODO: figure out what to do with the hash</a>
    <a id="2835" class="Symbol">{</a> <a id="2837" href="Ledger.GovStructure.html#228" class="Field">TxId</a> <a id="2842" class="Symbol">=</a> <a id="2844" href="Ledger.Transaction.html#1781" class="Field">TxId</a><a id="2848" class="Symbol">;</a> <a id="2850" href="Ledger.GovStructure.html#233" class="Field">Network</a> <a id="2858" class="Symbol">=</a> <a id="2860" href="Ledger.Epoch.html#1571" class="Function">Network</a><a id="2867" class="Symbol">;</a> <a id="2869" href="Ledger.GovStructure.html#241" class="Field">DocHash</a> <a id="2877" class="Symbol">=</a> <a id="2879" href="Ledger.Transaction.html#2016" class="Function">ADHash</a>
    <a id="2890" class="Symbol">;</a> <a id="2892" href="Ledger.GovStructure.html#339" class="Field">crypto</a> <a id="2899" class="Symbol">=</a> <a id="2901" href="Ledger.Transaction.html#2115" class="Field">crypto</a>
    <a id="2912" class="Symbol">;</a> <a id="2914" href="Ledger.GovStructure.html#387" class="Field">epochStructure</a> <a id="2929" class="Symbol">=</a> <a id="2931" href="Ledger.Transaction.html#2264" class="Field">epochStructure</a>
    <a id="2950" class="Symbol">;</a> <a id="2952" href="Ledger.GovStructure.html#459" class="Field">scriptStructure</a> <a id="2968" class="Symbol">=</a> <a id="2970" href="Ledger.Transaction.html#2386" class="Field">scriptStructure</a>
    <a id="2990" class="Symbol">;</a> <a id="2992" href="Ledger.GovStructure.html#638" class="Field">govParams</a> <a id="3002" class="Symbol">=</a> <a id="3004" href="Ledger.Transaction.html#2542" class="Field">govParams</a>
    <a id="3018" class="Symbol">}</a>

  <a id="3023" class="Keyword">open</a> <a id="3028" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a> <a id="3053" href="Ledger.Transaction.html#2730" class="Function">govStructure</a> <a id="3066" class="Keyword">hiding</a> <a id="3073" class="Symbol">(</a><a id="3074" href="Ledger.GovernanceActions.html#8498" class="InductiveConstructor">yes</a><a id="3077" class="Symbol">;</a> <a id="3079" href="Ledger.GovernanceActions.html#8502" class="InductiveConstructor">no</a><a id="3081" class="Symbol">)</a> <a id="3083" class="Keyword">public</a>
  <a id="3092" class="Keyword">open</a> <a id="3097" href="Ledger.Deleg.html" class="Module">Ledger.Deleg</a>             <a id="3122" href="Ledger.Transaction.html#2730" class="Function">govStructure</a> <a id="3135" class="Keyword">public</a>
<a id="3142" class="Markup">\end{code}</a><a id="3152" class="Background">
\emph{Derived types}
\AgdaTarget{TxIn, TxOut, UTxO, Wdrl}
</a><a id="3211" class="Markup">\begin{code}</a>
  <a id="TransactionStructure.TxIn"></a><a id="3226" href="Ledger.Transaction.html#3226" class="Function">TxIn</a>  <a id="3232" class="Symbol">=</a> <a id="3234" href="Ledger.Transaction.html#1781" class="Field">TxId</a> <a id="3239" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3241" href="Ledger.Transaction.html#1778" class="Field">Ix</a>
  <a id="TransactionStructure.TxOut"></a><a id="3246" href="Ledger.Transaction.html#3246" class="Function">TxOut</a> <a id="3252" class="Symbol">=</a> <a id="3254" href="Ledger.Address.html#1702" class="Function">Addr</a> <a id="3259" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3261" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a> <a id="3267" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3269" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3275" href="Ledger.Script.html#1993" class="Function">DataHash</a>
  <a id="TransactionStructure.UTxO"></a><a id="3286" href="Ledger.Transaction.html#3286" class="Function">UTxO</a>  <a id="3292" class="Symbol">=</a> <a id="3294" href="Ledger.Transaction.html#3226" class="Function">TxIn</a> <a id="3299" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="3301" href="Ledger.Transaction.html#3246" class="Function">TxOut</a>
  <a id="TransactionStructure.Wdrl"></a><a id="3309" href="Ledger.Transaction.html#3309" class="Function">Wdrl</a>  <a id="3315" class="Symbol">=</a> <a id="3317" href="Ledger.Address.html#1216" class="Record">RwdAddr</a> <a id="3325" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="3327" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>

  <a id="TransactionStructure.RdmrPtr"></a><a id="3335" href="Ledger.Transaction.html#3335" class="Function">RdmrPtr</a> <a id="3343" class="Symbol">:</a> <a id="3345" href="Agda.Primitive.html#320" class="Primitive">Set</a>
  <a id="3351" href="Ledger.Transaction.html#3335" class="Function">RdmrPtr</a> <a id="3359" class="Symbol">=</a> <a id="3361" href="Ledger.Transaction.html#756" class="Datatype">Tag</a> <a id="3365" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3367" href="Ledger.Transaction.html#1778" class="Field">Ix</a>

  <a id="TransactionStructure.ProposedPPUpdates"></a><a id="3373" href="Ledger.Transaction.html#3373" class="Function">ProposedPPUpdates</a>  <a id="3392" class="Symbol">=</a> <a id="3394" href="Ledger.Crypto.html#1698" class="Function">KeyHash</a> <a id="3402" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="3404" href="Ledger.PParams.html#5707" class="Function">PParamsUpdate</a>
  <a id="TransactionStructure.Update"></a><a id="3420" href="Ledger.Transaction.html#3420" class="Function">Update</a>             <a id="3439" class="Symbol">=</a> <a id="3441" href="Ledger.Transaction.html#3373" class="Function">ProposedPPUpdates</a> <a id="3459" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3461" href="Ledger.Epoch.html#295" class="Function">Epoch</a>
<a id="3467" class="Markup">\end{code}</a><a id="3477" class="Background">
\emph{Transaction types}
\AgdaTarget{TxBody, txins, txouts, txfee, txvldt, txwdrls, txup, txADhash, txsize, txid, TxWitnesses, vkSigs, scripts, Tx, body, wits, txAD}
\begin{AgdaSuppressSpace}
</a><a id="3670" class="Markup">\begin{code}</a>
  <a id="3685" class="Keyword">record</a> <a id="TransactionStructure.TxBody"></a><a id="3692" href="Ledger.Transaction.html#3692" class="Record">TxBody</a> <a id="3699" class="Symbol">:</a> <a id="3701" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3705" class="Keyword">where</a>
    <a id="3715" class="Keyword">field</a> <a id="3721" href="Ledger.Transaction.html#3721" class="Field">txins</a>          <a id="3736" class="Symbol">:</a> <a id="3738" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="3740" href="Ledger.Transaction.html#3226" class="Function">TxIn</a>
          <a id="3755" href="Ledger.Transaction.html#3755" class="Field">txouts</a>         <a id="3770" class="Symbol">:</a> <a id="3772" href="Ledger.Transaction.html#1778" class="Field">Ix</a> <a id="3775" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="3777" href="Ledger.Transaction.html#3246" class="Function">TxOut</a>
          <a id="3793" href="Ledger.Transaction.html#3793" class="Field">txfee</a>          <a id="3808" class="Symbol">:</a> <a id="3810" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
          <a id="3825" href="Ledger.Transaction.html#3825" class="Field">mint</a>           <a id="3840" class="Symbol">:</a> <a id="3842" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
          <a id="3858" href="Ledger.Transaction.html#3858" class="Field">txvldt</a>         <a id="3873" class="Symbol">:</a> <a id="3875" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3881" href="Ledger.Epoch.html#341" class="Function">Slot</a> <a id="3886" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3888" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3894" href="Ledger.Epoch.html#341" class="Function">Slot</a>
          <a id="3909" href="Ledger.Transaction.html#3909" class="Field">txcerts</a>        <a id="3924" class="Symbol">:</a> <a id="3926" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3931" href="Ledger.Deleg.html#353" class="Datatype">DCert</a>
          <a id="3947" href="Ledger.Transaction.html#3947" class="Field">txwdrls</a>        <a id="3962" class="Symbol">:</a> <a id="3964" href="Ledger.Transaction.html#3309" class="Function">Wdrl</a>
          <a id="3979" href="Ledger.Transaction.html#3979" class="Field">txvote</a>         <a id="3994" class="Symbol">:</a> <a id="3996" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="4001" href="Ledger.GovernanceActions.html#8529" class="Record">GovVote</a>
          <a id="4019" href="Ledger.Transaction.html#4019" class="Field">txprop</a>         <a id="4034" class="Symbol">:</a> <a id="4036" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="4041" href="Ledger.GovernanceActions.html#8716" class="Record">GovProposal</a>
          <a id="4063" href="Ledger.Transaction.html#4063" class="Field">txdonation</a>     <a id="4078" class="Symbol">:</a> <a id="4080" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
          <a id="4095" href="Ledger.Transaction.html#4095" class="Field">txup</a>           <a id="4110" class="Symbol">:</a> <a id="4112" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4118" href="Ledger.Transaction.html#3420" class="Function">Update</a>
          <a id="4135" href="Ledger.Transaction.html#4135" class="Field">txADhash</a>       <a id="4150" class="Symbol">:</a> <a id="4152" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4158" href="Ledger.Transaction.html#2016" class="Function">ADHash</a>
          <a id="4175" href="Ledger.Transaction.html#4175" class="Field">netwrk</a>         <a id="4190" class="Symbol">:</a> <a id="4192" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4198" href="Ledger.Epoch.html#1571" class="Function">Network</a>
          <a id="4216" href="Ledger.Transaction.html#4216" class="Field">txsize</a>         <a id="4231" class="Symbol">:</a> <a id="4233" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
          <a id="4245" href="Ledger.Transaction.html#4245" class="Field">txid</a>           <a id="4260" class="Symbol">:</a> <a id="4262" href="Ledger.Transaction.html#1781" class="Field">TxId</a>
          <a id="4277" href="Ledger.Transaction.html#4277" class="Field">collateral</a>     <a id="4292" class="Symbol">:</a> <a id="4294" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="4296" href="Ledger.Transaction.html#3226" class="Function">TxIn</a>
          <a id="4311" href="Ledger.Transaction.html#4311" class="Field">reqSigHash</a>     <a id="4326" class="Symbol">:</a> <a id="4328" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="4330" href="Ledger.Crypto.html#1698" class="Function">KeyHash</a>
          <a id="4348" href="Ledger.Transaction.html#4348" class="Field">scriptIntHash</a>  <a id="4363" class="Symbol">:</a> <a id="4365" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4371" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a>

  <a id="4385" class="Keyword">record</a> <a id="TransactionStructure.TxWitnesses"></a><a id="4392" href="Ledger.Transaction.html#4392" class="Record">TxWitnesses</a> <a id="4404" class="Symbol">:</a> <a id="4406" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4410" class="Keyword">where</a>
    <a id="4420" class="Keyword">field</a> <a id="4426" href="Ledger.Transaction.html#4426" class="Field">vkSigs</a>   <a id="4435" class="Symbol">:</a> <a id="4437" href="Ledger.Crypto.html#725" class="Function">VKey</a> <a id="4442" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="4444" href="Ledger.Crypto.html#730" class="Function">Sig</a>
          <a id="4458" href="Ledger.Transaction.html#4458" class="Field">scripts</a>  <a id="4467" class="Symbol">:</a> <a id="4469" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="4471" href="Ledger.Script.html#2808" class="Function">Script</a>
          <a id="4488" href="Ledger.Transaction.html#4488" class="Field">txdats</a>   <a id="4497" class="Symbol">:</a> <a id="4499" href="Ledger.Script.html#1993" class="Function">DataHash</a> <a id="4508" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="4510" href="Ledger.Script.html#2040" class="Function">Datum</a>
          <a id="4526" href="Ledger.Transaction.html#4526" class="Field">txrdmrs</a>  <a id="4535" class="Symbol">:</a> <a id="4537" href="Ledger.Transaction.html#3335" class="Function">RdmrPtr</a>  <a id="4546" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="4548" href="Ledger.Script.html#2058" class="Function">Redeemer</a> <a id="4557" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="4559" href="Ledger.Script.html#1554" class="Function">ExUnits</a>

    <a id="TransactionStructure.TxWitnesses.scriptsP1"></a><a id="4572" href="Ledger.Transaction.html#4572" class="Function">scriptsP1</a> <a id="4582" class="Symbol">:</a> <a id="4584" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="4586" href="Ledger.Script.html#629" class="Function">P1Script</a>
    <a id="4599" href="Ledger.Transaction.html#4572" class="Function">scriptsP1</a> <a id="4609" class="Symbol">=</a> <a id="4611" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="4622" href="Data.Sum.html#964" class="Function">isInj₁</a> <a id="4629" href="Ledger.Transaction.html#4458" class="Field">scripts</a>

  <a id="4640" class="Keyword">record</a> <a id="TransactionStructure.Tx"></a><a id="4647" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="4650" class="Symbol">:</a> <a id="4652" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4656" class="Keyword">where</a>
    <a id="4666" class="Keyword">field</a> <a id="4672" href="Ledger.Transaction.html#4672" class="Field">body</a>     <a id="4681" class="Symbol">:</a> <a id="4683" href="Ledger.Transaction.html#3692" class="Record">TxBody</a>
          <a id="4700" href="Ledger.Transaction.html#4700" class="Field">wits</a>     <a id="4709" class="Symbol">:</a> <a id="4711" href="Ledger.Transaction.html#4392" class="Record">TxWitnesses</a>
          <a id="4733" class="Comment">-- isValid  : Bool</a>
          <a id="4762" href="Ledger.Transaction.html#4762" class="Field">txAD</a>     <a id="4771" class="Symbol">:</a> <a id="4773" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4779" href="Ledger.Transaction.html#1786" class="Field">AuxiliaryData</a>

<a id="4794" class="Markup">\end{code}</a><a id="4804" class="Background">
\emph{Abstract functions}
</a><a id="4831" class="Markup">\begin{code}</a>
<a id="4844" class="Markup">\end{code}</a><a id="4854" class="Background">
\end{AgdaSuppressSpace}
\caption{Definitions used in the UTxO transition system}
\label{fig:defs:utxo-shelley}
\end{figure*}

\begin{figure*}[h]
</a><a id="5000" class="Markup">\begin{code}</a>
  <a id="TransactionStructure.getValue"></a><a id="5015" href="Ledger.Transaction.html#5015" class="Function">getValue</a> <a id="5024" class="Symbol">:</a> <a id="5026" href="Ledger.Transaction.html#3246" class="Function">TxOut</a> <a id="5032" class="Symbol">→</a> <a id="5034" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
  <a id="5042" href="Ledger.Transaction.html#5015" class="Function">getValue</a> <a id="5051" class="Symbol">(_</a> <a id="5054" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5056" href="Ledger.Transaction.html#5056" class="Bound">v</a> <a id="5058" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5060" class="Symbol">_)</a> <a id="5063" class="Symbol">=</a> <a id="5065" href="Ledger.Transaction.html#5056" class="Bound">v</a>

  <a id="TransactionStructure.txinsVKey"></a><a id="5070" href="Ledger.Transaction.html#5070" class="Function">txinsVKey</a> <a id="5080" class="Symbol">:</a> <a id="5082" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="5084" href="Ledger.Transaction.html#3226" class="Function">TxIn</a> <a id="5089" class="Symbol">→</a> <a id="5091" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="5096" class="Symbol">→</a> <a id="5098" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="5100" href="Ledger.Transaction.html#3226" class="Function">TxIn</a>
  <a id="5107" href="Ledger.Transaction.html#5070" class="Function">txinsVKey</a> <a id="5117" href="Ledger.Transaction.html#5117" class="Bound">txins</a> <a id="5123" href="Ledger.Transaction.html#5123" class="Bound">utxo</a> <a id="5128" class="Symbol">=</a> <a id="5130" href="Ledger.Transaction.html#5117" class="Bound">txins</a> <a id="5136" href="Axiom.Set.html#9060" class="Function Operator">∩</a> <a id="5138" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="5142" class="Symbol">(</a><a id="5143" href="Ledger.Transaction.html#5123" class="Bound">utxo</a> <a id="5148" href="Axiom.Set.Map.html#8033" class="Function Operator">↾&#39;</a> <a id="5151" href="Ledger.Set.Theory.html#574" class="Function">to-sp</a> <a id="5157" class="Symbol">(</a><a id="5158" href="Ledger.Address.html#2581" class="Function">isVKeyAddr?</a> <a id="5170" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="5172" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="5177" class="Symbol">))</a>

  <a id="TransactionStructure.scriptOuts"></a><a id="5183" href="Ledger.Transaction.html#5183" class="Function">scriptOuts</a> <a id="5194" class="Symbol">:</a> <a id="5196" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="5201" class="Symbol">→</a> <a id="5203" href="Ledger.Transaction.html#3286" class="Function">UTxO</a>
  <a id="5210" href="Ledger.Transaction.html#5183" class="Function">scriptOuts</a> <a id="5221" href="Ledger.Transaction.html#5221" class="Bound">utxo</a> <a id="5226" class="Symbol">=</a> <a id="5228" href="Axiom.Set.Map.html#4170" class="Function">filterᵐ</a> <a id="5236" class="Symbol">(</a><a id="5237" href="Axiom.Set.html#1220" class="Function">sp-∘</a> <a id="5242" class="Symbol">(</a><a id="5243" href="Ledger.Set.Theory.html#574" class="Function">to-sp</a> <a id="5249" href="Ledger.Address.html#2758" class="Function">isScriptAddr?</a><a id="5262" class="Symbol">)</a>
                             <a id="5293" class="Symbol">λ</a> <a id="5295" class="Symbol">{</a> <a id="5297" class="Symbol">(_</a> <a id="5300" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5302" href="Ledger.Transaction.html#5302" class="Bound">addr</a> <a id="5307" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5309" class="Symbol">_)</a> <a id="5312" class="Symbol">→</a> <a id="5314" href="Ledger.Transaction.html#5302" class="Bound">addr</a><a id="5318" class="Symbol">})</a> <a id="5321" href="Ledger.Transaction.html#5221" class="Bound">utxo</a>

  <a id="TransactionStructure.txinsScript"></a><a id="5329" href="Ledger.Transaction.html#5329" class="Function">txinsScript</a> <a id="5341" class="Symbol">:</a> <a id="5343" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="5345" href="Ledger.Transaction.html#3226" class="Function">TxIn</a> <a id="5350" class="Symbol">→</a> <a id="5352" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="5357" class="Symbol">→</a> <a id="5359" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="5361" href="Ledger.Transaction.html#3226" class="Function">TxIn</a>
  <a id="5368" href="Ledger.Transaction.html#5329" class="Function">txinsScript</a> <a id="5380" href="Ledger.Transaction.html#5380" class="Bound">txins</a> <a id="5386" href="Ledger.Transaction.html#5386" class="Bound">utxo</a> <a id="5391" class="Symbol">=</a> <a id="5393" href="Ledger.Transaction.html#5380" class="Bound">txins</a> <a id="5399" href="Axiom.Set.html#9060" class="Function Operator">∩</a> <a id="5401" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="5405" class="Symbol">(</a><a id="5406" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="5412" class="Symbol">(</a><a id="5413" href="Ledger.Transaction.html#5183" class="Function">scriptOuts</a> <a id="5424" href="Ledger.Transaction.html#5386" class="Bound">utxo</a><a id="5428" class="Symbol">))</a>

  <a id="TransactionStructure.lookupScriptHash"></a><a id="5434" href="Ledger.Transaction.html#5434" class="Function">lookupScriptHash</a> <a id="5451" class="Symbol">:</a> <a id="5453" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="5464" class="Symbol">→</a> <a id="5466" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="5469" class="Symbol">→</a> <a id="5471" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5477" href="Ledger.Script.html#2808" class="Function">Script</a>
  <a id="5486" href="Ledger.Transaction.html#5434" class="Function">lookupScriptHash</a> <a id="5503" href="Ledger.Transaction.html#5503" class="Bound">sh</a> <a id="5506" href="Ledger.Transaction.html#5506" class="Bound">tx</a> <a id="5509" class="Symbol">=</a>
    <a id="5515" href="Interface.Decidable.Instance.html#1221" class="Function Operator">ifᵈ</a> <a id="5519" href="Ledger.Transaction.html#5503" class="Bound">sh</a> <a id="5522" href="Interface.IsSet.html#493" class="Function Operator">∈</a> <a id="5524" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="5529" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="5535" class="Symbol">(</a><a id="5536" href="Ledger.Transaction.html#5605" class="Function">m</a> <a id="5538" href="Axiom.Set.Map.html#2338" class="Function Operator">ˢ</a><a id="5539" class="Symbol">)</a> <a id="5541" href="Interface.Decidable.Instance.html#1221" class="Function Operator">then</a>
      <a id="5552" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5557" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="5559" href="Axiom.Set.Map.html#10936" class="Function">lookupᵐ</a> <a id="5567" href="Ledger.Transaction.html#5605" class="Function">m</a> <a id="5569" href="Ledger.Transaction.html#5503" class="Bound">sh</a>
    <a id="5576" href="Interface.Decidable.Instance.html#1221" class="Function Operator">else</a>
      <a id="5587" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
    <a id="5599" class="Keyword">where</a> <a id="5605" href="Ledger.Transaction.html#5605" class="Function">m</a> <a id="5607" class="Symbol">=</a> <a id="5609" href="Ledger.Set.HashMap.html#278" class="Function">setToHashMap</a> <a id="5622" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="5624" href="Ledger.Transaction.html#5506" class="Bound">tx</a> <a id="5627" class="Symbol">.</a><a id="5628" href="Ledger.Transaction.html#4700" class="Field">Tx.wits</a> <a id="5636" class="Symbol">.</a><a id="5637" href="Ledger.Transaction.html#4458" class="Field">TxWitnesses.scripts</a>

  <a id="TransactionStructure.isP2Script"></a><a id="5660" href="Ledger.Transaction.html#5660" class="Function">isP2Script</a> <a id="5671" class="Symbol">:</a> <a id="5673" href="Ledger.Script.html#2808" class="Function">Script</a> <a id="5680" class="Symbol">→</a> <a id="5682" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
  <a id="5689" href="Ledger.Transaction.html#5660" class="Function">isP2Script</a> <a id="5700" class="Symbol">=</a> <a id="5702" href="Data.Maybe.Base.html#1096" class="Function">is-just</a> <a id="5710" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="5712" href="Data.Sum.html#1047" class="Function">isInj₂</a>
<a id="5719" class="Markup">\end{code}</a><a id="5729" class="Background">
\end{figure*}
</a><a id="5744" class="Markup">\begin{code}[hide]</a>
  <a id="5765" class="Keyword">instance</a>
    <a id="TransactionStructure.HasCoin-TxOut"></a><a id="5778" href="Ledger.Transaction.html#5778" class="Function">HasCoin-TxOut</a> <a id="5792" class="Symbol">:</a> <a id="5794" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="5802" href="Ledger.Transaction.html#3246" class="Function">TxOut</a>
    <a id="5812" href="Ledger.Transaction.html#5778" class="Function">HasCoin-TxOut</a> <a id="5826" class="Symbol">.</a><a id="5827" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="5835" class="Symbol">=</a> <a id="5837" href="Ledger.TokenAlgebra.html#924" class="Function">coin</a> <a id="5842" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="5844" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="5850" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="5852" href="Data.Product.Base.html#622" class="Field">proj₂</a>
<a id="5858" class="Markup">\end{code}</a><a id="5868" class="Background">
</a></pre></body></html>