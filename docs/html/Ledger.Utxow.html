<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxow</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\subsection{Witnessing}
</a><a id="25" class="Markup">\begin{code}[hide]</a>
<a id="44" class="Symbol">{-#</a> <a id="48" class="Keyword">OPTIONS</a> <a id="56" class="Pragma">--safe</a> <a id="63" class="Symbol">#-}</a>

<a id="68" class="Keyword">open</a> <a id="73" class="Keyword">import</a> <a id="80" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="95" class="Keyword">open</a> <a id="100" class="Keyword">import</a> <a id="107" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="121" class="Keyword">open</a> <a id="126" class="Keyword">import</a> <a id="133" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="149" class="Keyword">open</a> <a id="154" class="Keyword">import</a> <a id="161" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="181" class="Keyword">module</a> <a id="188" href="Ledger.Utxow.html" class="Module">Ledger.Utxow</a>
  <a id="203" class="Symbol">(</a><a id="204" href="Ledger.Utxow.html#204" class="Bound">txs</a> <a id="208" class="Symbol">:</a> <a id="210" class="Symbol">_)</a> <a id="213" class="Symbol">(</a><a id="214" class="Keyword">open</a> <a id="219" href="Ledger.Transaction.html#878" class="Module">TransactionStructure</a> <a id="240" href="Ledger.Utxow.html#204" class="Bound">txs</a><a id="243" class="Symbol">)</a>
  <a id="247" class="Symbol">(</a><a id="248" href="Ledger.Utxow.html#248" class="Bound">abs</a> <a id="252" class="Symbol">:</a> <a id="254" href="Ledger.Abstract.html#437" class="Record">AbstractFunctions</a> <a id="272" href="Ledger.Utxow.html#204" class="Bound">txs</a><a id="275" class="Symbol">)</a> <a id="277" class="Symbol">(</a><a id="278" class="Keyword">open</a> <a id="283" href="Ledger.Abstract.html#437" class="Module">AbstractFunctions</a> <a id="301" href="Ledger.Utxow.html#248" class="Bound">abs</a><a id="304" class="Symbol">)</a>
  <a id="308" class="Keyword">where</a>
<a id="314" class="Keyword">open</a> <a id="319" class="Keyword">import</a> <a id="326" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="338" href="Ledger.Utxow.html#204" class="Bound">txs</a> <a id="342" href="Ledger.Utxow.html#248" class="Bound">abs</a>
<a id="346" class="Markup">\end{code}</a><a id="356" class="Background">

\begin{figure*}[h]
</a><a id="377" class="Markup">\begin{code}</a>
<a id="getVKeys"></a><a id="390" href="Ledger.Utxow.html#390" class="Function">getVKeys</a> <a id="399" class="Symbol">:</a> <a id="401" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="403" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="414" class="Symbol">→</a> <a id="416" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="418" href="Ledger.Crypto.html#1698" class="Function">KeyHash</a>
<a id="426" href="Ledger.Utxow.html#390" class="Function">getVKeys</a> <a id="435" class="Symbol">=</a> <a id="437" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="448" href="Data.Sum.html#964" class="Function">isInj₁</a>

<a id="getScripts"></a><a id="456" href="Ledger.Utxow.html#456" class="Function">getScripts</a> <a id="467" class="Symbol">:</a> <a id="469" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="471" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="482" class="Symbol">→</a> <a id="484" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="486" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a>
<a id="497" href="Ledger.Utxow.html#456" class="Function">getScripts</a> <a id="508" class="Symbol">=</a> <a id="510" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="521" href="Data.Sum.html#1047" class="Function">isInj₂</a>

<a id="credsNeeded"></a><a id="529" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="541" class="Symbol">:</a> <a id="543" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="549" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="560" class="Symbol">→</a> <a id="562" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="567" class="Symbol">→</a> <a id="569" href="Ledger.Transaction.html#3692" class="Record">TxBody</a> <a id="576" class="Symbol">→</a> <a id="578" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="580" href="Ledger.Address.html#713" class="Function">Credential</a>
<a id="591" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="603" href="Ledger.Utxow.html#603" class="Bound">sh</a> <a id="606" href="Ledger.Utxow.html#606" class="Bound">utxo</a> <a id="611" href="Ledger.Utxow.html#611" class="Bound">txb</a>
  <a id="617" class="Symbol">=</a>  <a id="620" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="625" class="Symbol">(</a><a id="626" href="Ledger.Address.html#1958" class="Function">payCred</a> <a id="634" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="636" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="641" class="Symbol">)</a> <a id="643" class="Symbol">((</a><a id="645" href="Ledger.Utxow.html#606" class="Bound">utxo</a> <a id="650" href="Axiom.Set.Map.html#2338" class="Function Operator">ˢ</a><a id="651" class="Symbol">)</a> <a id="653" href="Axiom.Set.Rel.html#4467" class="Function Operator">⟪$⟫</a> <a id="657" href="Ledger.Transaction.html#3721" class="Field">txins</a><a id="662" class="Symbol">)</a>
  <a id="666" href="Axiom.Set.html#8720" class="Function Operator">∪</a>  <a id="669" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="674" href="Ledger.Deleg.html#2189" class="Function">cwitness</a> <a id="683" class="Symbol">(</a><a id="684" href="Axiom.Set.html#5489" class="Function">fromList</a> <a id="693" href="Ledger.Transaction.html#3909" class="Field">txcerts</a><a id="700" class="Symbol">)</a>
  <a id="704" href="Axiom.Set.html#8720" class="Function Operator">∪</a>  <a id="707" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="712" href="Ledger.GovernanceActions.html#8621" class="Field">GovVote.credential</a> <a id="731" class="Symbol">(</a><a id="732" href="Axiom.Set.html#5489" class="Function">fromList</a> <a id="741" href="Ledger.Transaction.html#3979" class="Field">txvote</a><a id="747" class="Symbol">)</a>
  <a id="751" href="Axiom.Set.html#8720" class="Function Operator">∪</a>  <a id="754" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="765" class="Symbol">(</a><a id="766" href="Function.Base.html#716" class="Function">const</a> <a id="772" class="Symbol">(</a><a id="773" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="778" href="Interface.Functor.html#418" class="Field Operator">&lt;$&gt;</a> <a id="782" href="Ledger.Utxow.html#603" class="Bound">sh</a><a id="784" class="Symbol">))</a> <a id="787" class="Symbol">(</a><a id="788" href="Axiom.Set.html#5489" class="Function">fromList</a> <a id="797" href="Ledger.Transaction.html#4019" class="Field">txprop</a><a id="803" class="Symbol">)</a>
  <a id="807" class="Keyword">where</a> <a id="813" class="Keyword">open</a> <a id="818" href="Ledger.Transaction.html#3692" class="Module">TxBody</a> <a id="825" href="Ledger.Utxow.html#611" class="Bound">txb</a>

<a id="witsVKeyNeeded"></a><a id="830" href="Ledger.Utxow.html#830" class="Function">witsVKeyNeeded</a> <a id="845" class="Symbol">:</a> <a id="847" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="853" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="864" class="Symbol">→</a> <a id="866" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="871" class="Symbol">→</a> <a id="873" href="Ledger.Transaction.html#3692" class="Record">TxBody</a> <a id="880" class="Symbol">→</a> <a id="882" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="884" href="Ledger.Crypto.html#1698" class="Function">KeyHash</a>
<a id="892" href="Ledger.Utxow.html#830" class="Function">witsVKeyNeeded</a> <a id="907" href="Ledger.Utxow.html#907" class="Bound">sh</a> <a id="910" class="Symbol">=</a> <a id="912" href="Ledger.Utxow.html#390" class="Function">getVKeys</a> <a id="921" href="Function.Base.html#1294" class="Function Operator">∘₂</a> <a id="924" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="936" href="Ledger.Utxow.html#907" class="Bound">sh</a>

<a id="scriptsNeeded"></a><a id="940" href="Ledger.Utxow.html#940" class="Function">scriptsNeeded</a>  <a id="955" class="Symbol">:</a> <a id="957" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="963" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="974" class="Symbol">→</a> <a id="976" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="981" class="Symbol">→</a> <a id="983" href="Ledger.Transaction.html#3692" class="Record">TxBody</a> <a id="990" class="Symbol">→</a> <a id="992" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="994" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a>
<a id="1005" href="Ledger.Utxow.html#940" class="Function">scriptsNeeded</a> <a id="1019" href="Ledger.Utxow.html#1019" class="Bound">sh</a> <a id="1022" class="Symbol">=</a> <a id="1024" href="Ledger.Utxow.html#456" class="Function">getScripts</a> <a id="1035" href="Function.Base.html#1294" class="Function Operator">∘₂</a> <a id="1038" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="1050" href="Ledger.Utxow.html#1019" class="Bound">sh</a>
<a id="1053" class="Markup">\end{code}</a><a id="1063" class="Background">
\caption{Functions used for witnessing}
\label{fig:functions:utxow}
\end{figure*}

\begin{figure*}[h]
</a><a id="1166" class="Markup">\begin{code}[hide]</a>
<a id="1185" class="Keyword">data</a>
<a id="1190" class="Markup">\end{code}</a><a id="1200" class="Background">
</a><a id="1201" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXOW⦈_"></a><a id="1216" href="Ledger.Utxow.html#1216" class="Datatype Operator">_⊢_⇀⦇_,UTXOW⦈_</a> <a id="1231" class="Symbol">:</a> <a id="1233" href="Ledger.Utxo.html#5871" class="Record">UTxOEnv</a> <a id="1241" class="Symbol">→</a> <a id="1243" href="Ledger.Utxo.html#6028" class="Record">UTxOState</a> <a id="1253" class="Symbol">→</a> <a id="1255" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="1258" class="Symbol">→</a> <a id="1260" href="Ledger.Utxo.html#6028" class="Record">UTxOState</a> <a id="1270" class="Symbol">→</a> <a id="1272" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1276" class="Markup">\end{code}</a><a id="1286" class="Background">
\caption{UTxOW transition-system types}
\label{fig:ts-types:utxow}
\end{figure*}

\begin{figure*}[h]
</a><a id="1388" class="Markup">\begin{code}[hide]</a>
<a id="1407" class="Keyword">private</a> <a id="1415" class="Keyword">variable</a>
  <a id="1426" href="Ledger.Utxow.html#1426" class="Generalizable">Γ</a> <a id="1428" class="Symbol">:</a> <a id="1430" href="Ledger.Utxo.html#5871" class="Record">UTxOEnv</a>
  <a id="1440" href="Ledger.Utxow.html#1440" class="Generalizable">s</a> <a id="1442" href="Ledger.Utxow.html#1442" class="Generalizable">s&#39;</a> <a id="1445" class="Symbol">:</a> <a id="1447" href="Ledger.Utxo.html#6028" class="Record">UTxOState</a>
  <a id="1459" href="Ledger.Utxow.html#1459" class="Generalizable">tx</a> <a id="1462" class="Symbol">:</a> <a id="1464" href="Ledger.Transaction.html#4647" class="Record">Tx</a>

<a id="1468" class="Keyword">data</a> <a id="1473" href="Ledger.Utxow.html#1216" class="Datatype Operator">_⊢_⇀⦇_,UTXOW⦈_</a> <a id="1488" class="Keyword">where</a>
<a id="1494" class="Markup">\end{code}</a><a id="1504" class="Background">
</a><a id="1505" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXOW⦈_.UTXOW-inductive"></a><a id="1520" href="Ledger.Utxow.html#1520" class="InductiveConstructor">UTXOW-inductive</a> <a id="1536" class="Symbol">:</a>
    <a id="1542" class="Keyword">let</a> <a id="1546" class="Keyword">open</a> <a id="1551" href="Ledger.Transaction.html#4647" class="Module">Tx</a> <a id="1554" href="Ledger.Utxow.html#1459" class="Generalizable">tx</a> <a id="1557" class="Keyword">renaming</a> <a id="1566" class="Symbol">(</a><a id="1567" href="Ledger.Transaction.html#4672" class="Field">body</a> <a id="1572" class="Symbol">to</a> <a id="1575" class="Field">txb</a><a id="1578" class="Symbol">);</a> <a id="1581" class="Keyword">open</a> <a id="1586" href="Ledger.Transaction.html#3692" class="Module">TxBody</a> <a id="1593" href="Ledger.Utxow.html#1575" class="Function">txb</a><a id="1596" class="Symbol">;</a> <a id="1598" class="Keyword">open</a> <a id="1603" href="Ledger.Transaction.html#4392" class="Module">TxWitnesses</a> <a id="1615" href="Ledger.Transaction.html#4700" class="Function">wits</a>
        <a id="1628" class="Keyword">open</a> <a id="1633" href="Ledger.Utxo.html#6028" class="Module">UTxOState</a> <a id="1643" href="Ledger.Utxow.html#1440" class="Generalizable">s</a><a id="1644" class="Symbol">;</a> <a id="1646" class="Keyword">open</a> <a id="1651" href="Ledger.Utxo.html#5871" class="Module">UTxOEnv</a> <a id="1659" href="Ledger.Utxow.html#1426" class="Generalizable">Γ</a>
        <a id="1669" href="Ledger.Utxow.html#1669" class="Bound">witsKeyHashes</a>     <a id="1687" class="Symbol">=</a> <a id="1689" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="1694" href="Interface.Hashable.html#195" class="Field">hash</a> <a id="1699" class="Symbol">(</a><a id="1700" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="1704" href="Ledger.Transaction.html#4426" class="Function">vkSigs</a><a id="1710" class="Symbol">)</a>
        <a id="1720" href="Ledger.Utxow.html#1720" class="Bound">witsScriptHashes</a>  <a id="1738" class="Symbol">=</a> <a id="1740" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="1745" href="Interface.Hashable.html#195" class="Field">hash</a> <a id="1750" href="Ledger.Transaction.html#4458" class="Function">scripts</a>
      <a id="1764" class="Keyword">in</a>
       <a id="1774" href="Interface.IsSet.html#611" class="Function">∀[</a> <a id="1777" href="Ledger.Utxow.html#1777" class="Bound">(</a><a id="1778" href="Ledger.Utxow.html#1778" class="Bound">vk</a> <a id="1781" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1783" href="Ledger.Utxow.html#1783" class="Bound">σ</a><a id="1784" href="Ledger.Utxow.html#1777" class="Bound">)</a> <a id="1786" href="Interface.IsSet.html#611" class="Function">∈</a> <a id="1788" href="Ledger.Transaction.html#4426" class="Function">vkSigs</a> <a id="1795" href="Interface.IsSet.html#611" class="Function">]</a> <a id="1797" href="Ledger.Crypto.html#790" class="Function">isSigned</a> <a id="1806" href="Ledger.Utxow.html#1778" class="Bound">vk</a> <a id="1809" class="Symbol">(</a><a id="1810" href="Ledger.Transaction.html#2676" class="Field">txidBytes</a> <a id="1820" href="Ledger.Transaction.html#4245" class="Function">txid</a><a id="1824" class="Symbol">)</a> <a id="1826" href="Ledger.Utxow.html#1783" class="Bound">σ</a>
    <a id="1832" class="Symbol">→</a>  <a id="1835" href="Interface.IsSet.html#611" class="Function">∀[</a> <a id="1838" href="Ledger.Utxow.html#1838" class="Bound">s</a> <a id="1840" href="Interface.IsSet.html#611" class="Function">∈</a> <a id="1842" href="Ledger.Transaction.html#4572" class="Function">scriptsP1</a> <a id="1852" href="Interface.IsSet.html#611" class="Function">]</a> <a id="1854" href="Ledger.Script.html#652" class="Function">validP1Script</a> <a id="1868" href="Ledger.Utxow.html#1669" class="Bound">witsKeyHashes</a> <a id="1882" href="Ledger.Transaction.html#3858" class="Function">txvldt</a> <a id="1889" href="Ledger.Utxow.html#1838" class="Bound">s</a>
    <a id="1895" class="Symbol">→</a>  <a id="1898" href="Ledger.Utxow.html#830" class="Function">witsVKeyNeeded</a> <a id="1913" href="Ledger.Utxo.html#5923" class="Function">ppolicy</a> <a id="1921" href="Ledger.Utxo.html#6083" class="Function">utxo</a> <a id="1926" href="Ledger.Utxow.html#1575" class="Function">txb</a> <a id="1930" href="Axiom.Set.html#1697" class="Function Operator">⊆</a> <a id="1932" href="Ledger.Utxow.html#1669" class="Bound">witsKeyHashes</a>
    <a id="1950" class="Symbol">→</a>  <a id="1953" href="Ledger.Utxow.html#940" class="Function">scriptsNeeded</a> <a id="1967" href="Ledger.Utxo.html#5923" class="Function">ppolicy</a> <a id="1975" href="Ledger.Utxo.html#6083" class="Function">utxo</a> <a id="1980" href="Ledger.Utxow.html#1575" class="Function">txb</a> <a id="1984" href="Axiom.Set.html#2471" class="Function Operator">≡ᵉ</a> <a id="1987" href="Ledger.Utxow.html#1720" class="Bound">witsScriptHashes</a>
    <a id="2008" class="Symbol">→</a>  <a id="2011" href="Ledger.Transaction.html#4135" class="Function">txADhash</a> <a id="2020" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2022" href="Interface.Functor.html#448" class="Function">map</a> <a id="2026" href="Interface.Hashable.html#195" class="Field">hash</a> <a id="2031" href="Ledger.Transaction.html#4762" class="Function">txAD</a>
    <a id="2040" class="Symbol">→</a>  <a id="2043" href="Ledger.Utxow.html#1426" class="Generalizable">Γ</a> <a id="2045" href="Ledger.Utxo.html#7401" class="Datatype Operator">⊢</a> <a id="2047" href="Ledger.Utxow.html#1440" class="Generalizable">s</a> <a id="2049" href="Ledger.Utxo.html#7401" class="Datatype Operator">⇀⦇</a> <a id="2052" href="Ledger.Utxow.html#1459" class="Generalizable">tx</a> <a id="2055" href="Ledger.Utxo.html#7401" class="Datatype Operator">,UTXO⦈</a> <a id="2062" href="Ledger.Utxow.html#1442" class="Generalizable">s&#39;</a>
       <a id="2072" href="Interface.STS.html#244" class="Function Operator">────────────────────────────────</a>
       <a id="2112" href="Ledger.Utxow.html#1426" class="Generalizable">Γ</a> <a id="2114" href="Ledger.Utxow.html#1216" class="Datatype Operator">⊢</a> <a id="2116" href="Ledger.Utxow.html#1440" class="Generalizable">s</a> <a id="2118" href="Ledger.Utxow.html#1216" class="Datatype Operator">⇀⦇</a> <a id="2121" href="Ledger.Utxow.html#1459" class="Generalizable">tx</a> <a id="2124" href="Ledger.Utxow.html#1216" class="Datatype Operator">,UTXOW⦈</a> <a id="2132" href="Ledger.Utxow.html#1442" class="Generalizable">s&#39;</a>
<a id="2135" class="Markup">\end{code}</a><a id="2145" class="Background">
\caption{UTXOW inference rules}
\label{fig:rules:utxow}
\end{figure*}
</a></pre></body></html>