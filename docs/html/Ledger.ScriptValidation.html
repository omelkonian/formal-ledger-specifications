<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.ScriptValidation</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">import</a> <a id="32" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="43" class="Symbol">as</a> <a id="46" class="Module">M</a>

<a id="49" class="Keyword">open</a> <a id="54" class="Keyword">import</a> <a id="61" href="Interface.Decidable.Instance.html" class="Module">Interface.Decidable.Instance</a>
<a id="90" class="Keyword">open</a> <a id="95" class="Keyword">import</a> <a id="102" href="Tactic.AnyOf.html" class="Module">Tactic.AnyOf</a>
<a id="115" class="Keyword">open</a> <a id="120" class="Keyword">import</a> <a id="127" href="Tactic.Assumption.html" class="Module">Tactic.Assumption</a>
<a id="145" class="Keyword">open</a> <a id="150" class="Keyword">import</a> <a id="157" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>
<a id="173" class="Keyword">open</a> <a id="178" class="Keyword">import</a> <a id="185" href="Tactic.Helpers.html" class="Module">Tactic.Helpers</a>

<a id="201" class="Keyword">open</a> <a id="206" class="Keyword">import</a> <a id="213" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="227" class="Symbol">;</a> <a id="229" class="Keyword">open</a> <a id="234" href="Ledger.Set.Theory.html#2438" class="Module">Properties</a>
<a id="245" class="Keyword">open</a> <a id="250" class="Keyword">import</a> <a id="257" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>
<a id="276" class="Keyword">open</a> <a id="281" class="Keyword">import</a> <a id="288" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="304" class="Keyword">open</a> <a id="309" class="Keyword">import</a> <a id="316" href="Ledger.Script.html" class="Module">Ledger.Script</a>
<a id="330" class="Keyword">open</a> <a id="335" class="Keyword">import</a> <a id="342" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>


<a id="358" class="Keyword">module</a> <a id="365" href="Ledger.ScriptValidation.html" class="Module">Ledger.ScriptValidation</a>
  <a id="391" class="Symbol">(</a><a id="392" href="Ledger.ScriptValidation.html#392" class="Bound">txs</a> <a id="396" class="Symbol">:</a> <a id="398" class="Symbol">_)</a> <a id="401" class="Symbol">(</a><a id="402" class="Keyword">open</a> <a id="407" href="Ledger.Transaction.html#878" class="Module">TransactionStructure</a> <a id="428" href="Ledger.ScriptValidation.html#392" class="Bound">txs</a><a id="431" class="Symbol">)</a>
  <a id="435" class="Symbol">(</a><a id="436" href="Ledger.ScriptValidation.html#436" class="Bound">abs</a> <a id="440" class="Symbol">:</a> <a id="442" href="Ledger.Abstract.html#437" class="Record">AbstractFunctions</a> <a id="460" href="Ledger.ScriptValidation.html#392" class="Bound">txs</a><a id="463" class="Symbol">)</a> <a id="465" class="Symbol">(</a><a id="466" class="Keyword">open</a> <a id="471" href="Ledger.Abstract.html#437" class="Module">AbstractFunctions</a> <a id="489" href="Ledger.ScriptValidation.html#436" class="Bound">abs</a><a id="492" class="Symbol">)</a> <a id="494" class="Symbol">(</a><a id="495" class="Keyword">open</a> <a id="500" href="Ledger.Abstract.html#195" class="Module">indexOf</a> <a id="508" href="Ledger.Abstract.html#566" class="Field">indexOfImp</a><a id="518" class="Symbol">)</a>
  <a id="522" class="Keyword">where</a>

<a id="529" class="Comment">-- Because of missing macro hygiene, we have to copy&amp;paste this. https://github.com/agda/agda/issues/3819</a>
<a id="635" class="Keyword">private</a> <a id="643" class="Keyword">macro</a>
  <a id="∈⇒P"></a><a id="651" href="Ledger.ScriptValidation.html#651" class="Function">∈⇒P</a> <a id="655" class="Symbol">=</a> <a id="657" href="Tactic.AnyOf.html#1166" class="Function">anyOfⁿᵗ</a> <a id="665" class="Symbol">(</a><a id="666" class="Keyword">quote</a> <a id="672" href="Axiom.Set.Properties.html#1734" class="Function">∈-filter⁻&#39;</a> <a id="683" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="685" class="Keyword">quote</a> <a id="691" href="Axiom.Set.Properties.html#1923" class="Function">∈-∪⁻</a> <a id="696" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="698" class="Keyword">quote</a> <a id="704" href="Axiom.Set.Properties.html#1422" class="Function">∈-map⁻&#39;</a> <a id="712" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="714" class="Keyword">quote</a> <a id="720" href="Axiom.Set.Properties.html#2061" class="Function">∈-fromList⁻</a> <a id="732" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="734" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="736" class="Symbol">)</a>
  <a id="P⇒∈"></a><a id="740" href="Ledger.ScriptValidation.html#740" class="Function">P⇒∈</a> <a id="744" class="Symbol">=</a> <a id="746" href="Tactic.AnyOf.html#1166" class="Function">anyOfⁿᵗ</a> <a id="754" class="Symbol">(</a><a id="755" class="Keyword">quote</a> <a id="761" href="Axiom.Set.Properties.html#1813" class="Function">∈-filter⁺&#39;</a> <a id="772" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="774" class="Keyword">quote</a> <a id="780" href="Axiom.Set.Properties.html#1977" class="Function">∈-∪⁺</a> <a id="785" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="787" class="Keyword">quote</a> <a id="793" href="Axiom.Set.Properties.html#1497" class="Function">∈-map⁺&#39;</a> <a id="801" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="803" class="Keyword">quote</a> <a id="809" href="Axiom.Set.Properties.html#2134" class="Function">∈-fromList⁺</a> <a id="821" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="823" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="825" class="Symbol">)</a>
  <a id="∈⇔P"></a><a id="829" href="Ledger.ScriptValidation.html#829" class="Function">∈⇔P</a> <a id="833" class="Symbol">=</a> <a id="835" href="Tactic.AnyOf.html#1166" class="Function">anyOfⁿᵗ</a> <a id="843" class="Symbol">(</a><a id="844" class="Keyword">quote</a> <a id="850" href="Axiom.Set.Properties.html#1734" class="Function">∈-filter⁻&#39;</a> <a id="861" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="863" class="Keyword">quote</a> <a id="869" href="Axiom.Set.Properties.html#1923" class="Function">∈-∪⁻</a> <a id="874" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="876" class="Keyword">quote</a> <a id="882" href="Axiom.Set.Properties.html#1422" class="Function">∈-map⁻&#39;</a> <a id="890" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="892" class="Keyword">quote</a> <a id="898" href="Axiom.Set.Properties.html#2061" class="Function">∈-fromList⁻</a> <a id="910" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="912" class="Keyword">quote</a> <a id="918" href="Axiom.Set.Properties.html#1813" class="Function">∈-filter⁺&#39;</a> <a id="929" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="931" class="Keyword">quote</a> <a id="937" href="Axiom.Set.Properties.html#1977" class="Function">∈-∪⁺</a> <a id="942" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="944" class="Keyword">quote</a> <a id="950" href="Axiom.Set.Properties.html#1497" class="Function">∈-map⁺&#39;</a> <a id="958" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="960" class="Keyword">quote</a> <a id="966" href="Axiom.Set.Properties.html#2134" class="Function">∈-fromList⁺</a> <a id="978" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="980" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="982" class="Symbol">)</a>

<a id="985" class="Keyword">data</a> <a id="ScriptPurpose"></a><a id="990" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="1004" class="Symbol">:</a> <a id="1006" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1010" class="Keyword">where</a>
  <a id="ScriptPurpose.Cert"></a><a id="1018" href="Ledger.ScriptValidation.html#1018" class="InductiveConstructor">Cert</a>  <a id="1024" class="Symbol">:</a> <a id="1026" href="Ledger.Deleg.html#353" class="Datatype">DCert</a>      <a id="1037" class="Symbol">→</a> <a id="1039" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Rwrd"></a><a id="1055" href="Ledger.ScriptValidation.html#1055" class="InductiveConstructor">Rwrd</a>  <a id="1061" class="Symbol">:</a> <a id="1063" href="Ledger.Address.html#1216" class="Record">RwdAddr</a>    <a id="1074" class="Symbol">→</a> <a id="1076" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Mint"></a><a id="1092" href="Ledger.ScriptValidation.html#1092" class="InductiveConstructor">Mint</a>  <a id="1098" class="Symbol">:</a> <a id="1100" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a> <a id="1111" class="Symbol">→</a> <a id="1113" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Spend"></a><a id="1129" href="Ledger.ScriptValidation.html#1129" class="InductiveConstructor">Spend</a> <a id="1135" class="Symbol">:</a> <a id="1137" href="Ledger.Transaction.html#3226" class="Function">TxIn</a>       <a id="1148" class="Symbol">→</a> <a id="1150" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a>

<a id="rdptr"></a><a id="1165" href="Ledger.ScriptValidation.html#1165" class="Function">rdptr</a> <a id="1171" class="Symbol">:</a> <a id="1173" href="Ledger.Transaction.html#3692" class="Record">TxBody</a> <a id="1180" class="Symbol">→</a> <a id="1182" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="1196" class="Symbol">→</a> <a id="1198" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1204" href="Ledger.Transaction.html#3335" class="Function">RdmrPtr</a>
<a id="1212" href="Ledger.ScriptValidation.html#1165" class="Function">rdptr</a> <a id="1218" href="Ledger.ScriptValidation.html#1218" class="Bound">txb</a> <a id="1222" class="Symbol">=</a> <a id="1224" class="Symbol">λ</a> <a id="1226" class="Keyword">where</a>
  <a id="1234" class="Symbol">(</a><a id="1235" href="Ledger.ScriptValidation.html#1018" class="InductiveConstructor">Cert</a> <a id="1240" href="Ledger.ScriptValidation.html#1240" class="Bound">h</a><a id="1241" class="Symbol">)</a>  <a id="1244" class="Symbol">→</a> <a id="1246" href="Data.Maybe.Base.html#2035" class="Function">M.map</a> <a id="1252" class="Symbol">(</a><a id="1253" href="Ledger.Transaction.html#785" class="InductiveConstructor">Cert</a>  <a id="1259" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,_</a><a id="1261" class="Symbol">)</a> <a id="1263" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="1265" href="Ledger.Abstract.html#227" class="Function">indexOfDCert</a>    <a id="1281" href="Ledger.ScriptValidation.html#1240" class="Bound">h</a> <a id="1283" href="Ledger.Transaction.html#3909" class="Field">txcerts</a>
  <a id="1293" class="Symbol">(</a><a id="1294" href="Ledger.ScriptValidation.html#1055" class="InductiveConstructor">Rwrd</a> <a id="1299" href="Ledger.ScriptValidation.html#1299" class="Bound">h</a><a id="1300" class="Symbol">)</a>  <a id="1303" class="Symbol">→</a> <a id="1305" href="Data.Maybe.Base.html#2035" class="Function">M.map</a> <a id="1311" class="Symbol">(</a><a id="1312" href="Ledger.Transaction.html#790" class="InductiveConstructor">Rewrd</a> <a id="1318" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,_</a><a id="1320" class="Symbol">)</a> <a id="1322" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="1324" href="Ledger.Abstract.html#279" class="Function">indexOfRwdAddr</a>  <a id="1340" href="Ledger.ScriptValidation.html#1299" class="Bound">h</a> <a id="1342" href="Ledger.Transaction.html#3947" class="Field">txwdrls</a>
  <a id="1352" class="Symbol">(</a><a id="1353" href="Ledger.ScriptValidation.html#1092" class="InductiveConstructor">Mint</a> <a id="1358" href="Ledger.ScriptValidation.html#1358" class="Bound">h</a><a id="1359" class="Symbol">)</a>  <a id="1362" class="Symbol">→</a> <a id="1364" href="Data.Maybe.Base.html#2035" class="Function">M.map</a> <a id="1370" class="Symbol">(</a><a id="1371" href="Ledger.Transaction.html#780" class="InductiveConstructor">Mint</a>  <a id="1377" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,_</a><a id="1379" class="Symbol">)</a> <a id="1381" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="1383" href="Ledger.Abstract.html#374" class="Function">indexOfPolicyId</a> <a id="1399" href="Ledger.ScriptValidation.html#1358" class="Bound">h</a> <a id="1401" class="Symbol">(</a><a id="1402" href="Ledger.TokenAlgebra.html#1024" class="Function">policies</a> <a id="1411" href="Ledger.Transaction.html#3825" class="Field">mint</a><a id="1415" class="Symbol">)</a>
  <a id="1419" class="Symbol">(</a><a id="1420" href="Ledger.ScriptValidation.html#1129" class="InductiveConstructor">Spend</a> <a id="1426" href="Ledger.ScriptValidation.html#1426" class="Bound">h</a><a id="1427" class="Symbol">)</a> <a id="1429" class="Symbol">→</a> <a id="1431" href="Data.Maybe.Base.html#2035" class="Function">M.map</a> <a id="1437" class="Symbol">(</a><a id="1438" href="Ledger.Transaction.html#774" class="InductiveConstructor">Spend</a> <a id="1444" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,_</a><a id="1446" class="Symbol">)</a> <a id="1448" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="1450" href="Ledger.Abstract.html#327" class="Function">indexOfTxIn</a>     <a id="1466" href="Ledger.ScriptValidation.html#1426" class="Bound">h</a> <a id="1468" href="Ledger.Transaction.html#3721" class="Field">txins</a>
 <a id="1475" class="Keyword">where</a> <a id="1481" class="Keyword">open</a> <a id="1486" href="Ledger.Transaction.html#3692" class="Module">TxBody</a> <a id="1493" href="Ledger.ScriptValidation.html#1218" class="Bound">txb</a>

<a id="indexedRdmrs"></a><a id="1498" href="Ledger.ScriptValidation.html#1498" class="Function">indexedRdmrs</a> <a id="1511" class="Symbol">:</a> <a id="1513" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="1516" class="Symbol">→</a> <a id="1518" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="1532" class="Symbol">→</a> <a id="1534" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1540" class="Symbol">(</a><a id="1541" href="Ledger.Script.html#2058" class="Function">Redeemer</a> <a id="1550" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="1552" href="Ledger.Script.html#1554" class="Function">ExUnits</a><a id="1559" class="Symbol">)</a>
<a id="1561" href="Ledger.ScriptValidation.html#1498" class="Function">indexedRdmrs</a> <a id="1574" href="Ledger.ScriptValidation.html#1574" class="Bound">tx</a> <a id="1577" href="Ledger.ScriptValidation.html#1577" class="Bound">sp</a> <a id="1580" class="Symbol">=</a> <a id="1582" href="Data.Maybe.Base.html#1377" class="Function">maybe</a> <a id="1588" class="Symbol">(λ</a> <a id="1591" href="Ledger.ScriptValidation.html#1591" class="Bound">x</a> <a id="1593" class="Symbol">→</a> <a id="1595" href="Axiom.Set.Map.html#11041" class="Function">lookupᵐ?</a> <a id="1604" href="Ledger.Transaction.html#4526" class="Function">txrdmrs</a> <a id="1612" href="Ledger.ScriptValidation.html#1591" class="Bound">x</a> <a id="1614" class="Symbol">⦃</a> <a id="1616" class="Symbol">_</a> <a id="1618" href="Axiom.Set.html#10312" class="Function Operator">∈?</a> <a id="1621" class="Symbol">_</a> <a id="1623" class="Symbol">⦄)</a> <a id="1626" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="1634" class="Symbol">(</a><a id="1635" href="Ledger.ScriptValidation.html#1165" class="Function">rdptr</a> <a id="1641" href="Ledger.Transaction.html#4672" class="Function">body</a> <a id="1646" href="Ledger.ScriptValidation.html#1577" class="Bound">sp</a><a id="1648" class="Symbol">)</a>
  <a id="1652" class="Keyword">where</a> <a id="1658" class="Keyword">open</a> <a id="1663" href="Ledger.Transaction.html#4647" class="Module">Tx</a> <a id="1666" href="Ledger.ScriptValidation.html#1574" class="Bound">tx</a><a id="1668" class="Symbol">;</a> <a id="1670" class="Keyword">open</a> <a id="1675" href="Ledger.Transaction.html#4392" class="Module">TxWitnesses</a> <a id="1687" href="Ledger.Transaction.html#4700" class="Function">wits</a>

<a id="1693" class="Comment">-- Abstract Script Validation Functions</a>

<a id="1734" class="Comment">-- epochInfoSlotToUTCTime : EpochInfo → SystemStart → Slot → -- UTCTime? Translate slot number to system time or fail</a>

<a id="1853" class="Comment">-- runPLCScript : CostModel → Scriptplc → ExUnits → Data∗ → IsValid</a>
<a id="1921" class="Comment">-- Validate a Plutus script, taking resource limits into account</a>

<a id="1987" class="Comment">-- Notation</a>

<a id="getDatum"></a><a id="2000" href="Ledger.ScriptValidation.html#2000" class="Function">getDatum</a> <a id="2009" class="Symbol">:</a> <a id="2011" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="2014" class="Symbol">→</a> <a id="2016" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="2021" class="Symbol">→</a> <a id="2023" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="2037" class="Symbol">→</a> <a id="2039" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2044" href="Ledger.Script.html#2040" class="Function">Datum</a>
<a id="2050" href="Ledger.ScriptValidation.html#2000" class="Function">getDatum</a> <a id="2059" href="Ledger.ScriptValidation.html#2059" class="Bound">tx</a> <a id="2062" href="Ledger.ScriptValidation.html#2062" class="Bound">utxo</a> <a id="2067" class="Symbol">(</a><a id="2068" href="Ledger.ScriptValidation.html#1129" class="InductiveConstructor">Spend</a> <a id="2074" href="Ledger.ScriptValidation.html#2074" class="Bound">txin</a><a id="2078" class="Symbol">)</a> <a id="2080" class="Symbol">=</a> <a id="2082" class="Keyword">let</a> <a id="2086" class="Keyword">open</a> <a id="2091" href="Ledger.Transaction.html#4647" class="Module">Tx</a> <a id="2094" href="Ledger.ScriptValidation.html#2059" class="Bound">tx</a><a id="2096" class="Symbol">;</a> <a id="2098" class="Keyword">open</a> <a id="2103" href="Ledger.Transaction.html#4392" class="Module">TxWitnesses</a> <a id="2115" href="Ledger.Transaction.html#4700" class="Function">wits</a> <a id="2120" class="Keyword">in</a>
  <a id="2125" href="Data.Maybe.Base.html#1377" class="Function">maybe</a>
    <a id="2135" class="Symbol">(λ</a> <a id="2138" class="Symbol">{</a> <a id="2140" class="Symbol">(_</a> <a id="2143" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2145" class="Symbol">_</a> <a id="2147" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2149" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2154" href="Ledger.ScriptValidation.html#2154" class="Bound">x</a><a id="2155" class="Symbol">)</a> <a id="2157" class="Symbol">→</a>
         <a id="2168" href="Data.Maybe.Base.html#1377" class="Function">maybe</a> <a id="2174" class="Symbol">(λ</a> <a id="2177" href="Ledger.ScriptValidation.html#2177" class="Bound">x₁</a> <a id="2180" class="Symbol">→</a> <a id="2182" href="Data.List.Base.html#5219" class="Function Operator">[</a> <a id="2184" href="Ledger.ScriptValidation.html#2177" class="Bound">x₁</a> <a id="2187" href="Data.List.Base.html#5219" class="Function Operator">]</a><a id="2188" class="Symbol">)</a> <a id="2190" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="2193" class="Symbol">(</a><a id="2194" href="Axiom.Set.Map.html#11041" class="Function">lookupᵐ?</a> <a id="2203" href="Ledger.Transaction.html#4488" class="Function">txdats</a> <a id="2210" href="Ledger.ScriptValidation.html#2154" class="Bound">x</a> <a id="2212" class="Symbol">⦃</a> <a id="2214" class="Symbol">_</a> <a id="2216" href="Axiom.Set.html#10312" class="Function Operator">∈?</a> <a id="2219" class="Symbol">_</a> <a id="2221" class="Symbol">⦄)</a>
       <a id="2231" class="Symbol">;</a> <a id="2233" class="Symbol">(_</a> <a id="2236" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2238" class="Symbol">_</a> <a id="2240" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2242" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="2249" class="Symbol">)</a> <a id="2251" class="Symbol">→</a> <a id="2253" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
       <a id="2263" class="Symbol">})</a>
    <a id="2270" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
    <a id="2277" class="Symbol">(</a><a id="2278" href="Axiom.Set.Map.html#11041" class="Function">lookupᵐ?</a> <a id="2287" href="Ledger.ScriptValidation.html#2062" class="Bound">utxo</a> <a id="2292" href="Ledger.ScriptValidation.html#2074" class="Bound">txin</a> <a id="2297" class="Symbol">⦃</a> <a id="2299" class="Symbol">_</a> <a id="2301" href="Axiom.Set.html#10312" class="Function Operator">∈?</a> <a id="2304" class="Symbol">_</a> <a id="2306" class="Symbol">⦄)</a>
<a id="2309" href="Ledger.ScriptValidation.html#2000" class="CatchallClause Function">getDatum</a><a id="2317" class="CatchallClause"> </a><a id="2318" href="Ledger.ScriptValidation.html#2318" class="CatchallClause Bound">tx</a><a id="2320" class="CatchallClause"> </a><a id="2321" href="Ledger.ScriptValidation.html#2321" class="CatchallClause Bound">utxo</a><a id="2325" class="CatchallClause"> </a><a id="2326" class="CatchallClause Symbol">_</a> <a id="2328" class="Symbol">=</a> <a id="2330" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>


<a id="2335" class="Keyword">record</a> <a id="TxInfo"></a><a id="2342" href="Ledger.ScriptValidation.html#2342" class="Record">TxInfo</a> <a id="2349" class="Symbol">:</a> <a id="2351" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2355" class="Keyword">where</a>
  <a id="2363" class="Keyword">field</a> <a id="TxInfo.realizedInputs"></a><a id="2369" href="Ledger.ScriptValidation.html#2369" class="Field">realizedInputs</a> <a id="2384" class="Symbol">:</a> <a id="2386" href="Ledger.Transaction.html#3286" class="Function">UTxO</a>
        <a id="TxInfo.txouts"></a><a id="2399" href="Ledger.ScriptValidation.html#2399" class="Field">txouts</a>  <a id="2407" class="Symbol">:</a> <a id="2409" href="Ledger.Transaction.html#1778" class="Field">Ix</a> <a id="2412" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="2414" href="Ledger.Transaction.html#3246" class="Function">TxOut</a>
        <a id="TxInfo.fee"></a><a id="2428" href="Ledger.ScriptValidation.html#2428" class="Field">fee</a>     <a id="2436" class="Symbol">:</a> <a id="2438" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
        <a id="TxInfo.mint"></a><a id="2452" href="Ledger.ScriptValidation.html#2452" class="Field">mint</a>    <a id="2460" class="Symbol">:</a> <a id="2462" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
        <a id="TxInfo.txcerts"></a><a id="2476" href="Ledger.ScriptValidation.html#2476" class="Field">txcerts</a> <a id="2484" class="Symbol">:</a> <a id="2486" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2491" href="Ledger.Deleg.html#353" class="Datatype">DCert</a>
        <a id="TxInfo.txwdrls"></a><a id="2505" href="Ledger.ScriptValidation.html#2505" class="Field">txwdrls</a> <a id="2513" class="Symbol">:</a> <a id="2515" href="Ledger.Transaction.html#3309" class="Function">Wdrl</a>
        <a id="TxInfo.txvldt"></a><a id="2528" href="Ledger.ScriptValidation.html#2528" class="Field">txvldt</a>  <a id="2536" class="Symbol">:</a> <a id="2538" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2544" href="Ledger.Epoch.html#341" class="Function">Slot</a> <a id="2549" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="2551" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2557" href="Ledger.Epoch.html#341" class="Function">Slot</a>
        <a id="TxInfo.vkKey"></a><a id="2570" href="Ledger.ScriptValidation.html#2570" class="Field">vkKey</a>   <a id="2578" class="Symbol">:</a> <a id="2580" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="2582" href="Ledger.Crypto.html#1698" class="Function">KeyHash</a>
        <a id="TxInfo.txdats"></a><a id="2598" href="Ledger.ScriptValidation.html#2598" class="Field">txdats</a>  <a id="2606" class="Symbol">:</a> <a id="2608" href="Ledger.Script.html#1993" class="Function">DataHash</a> <a id="2617" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="2619" href="Ledger.Script.html#2040" class="Function">Datum</a>
        <a id="TxInfo.txid"></a><a id="2633" href="Ledger.ScriptValidation.html#2633" class="Field">txid</a>    <a id="2641" class="Symbol">:</a> <a id="2643" href="Ledger.Transaction.html#1781" class="Field">TxId</a>

<a id="txInfo"></a><a id="2649" href="Ledger.ScriptValidation.html#2649" class="Function">txInfo</a> <a id="2656" class="Symbol">:</a> <a id="2658" href="Ledger.Script.html#1089" class="Function">Language</a> <a id="2667" class="Symbol">→</a> <a id="2669" href="Ledger.PParams.html#1143" class="Record">PParams</a>
                  <a id="2695" class="Symbol">→</a> <a id="2697" href="Ledger.Transaction.html#3286" class="Function">UTxO</a>
                  <a id="2720" class="Symbol">→</a> <a id="2722" href="Ledger.Transaction.html#4647" class="Record">Tx</a>
                  <a id="2743" class="Symbol">→</a> <a id="2745" href="Ledger.ScriptValidation.html#2342" class="Record">TxInfo</a>
<a id="2752" href="Ledger.ScriptValidation.html#2649" class="Function">txInfo</a> <a id="2759" href="Ledger.ScriptValidation.html#2759" class="Bound">l</a> <a id="2761" href="Ledger.ScriptValidation.html#2761" class="Bound">pp</a> <a id="2764" href="Ledger.ScriptValidation.html#2764" class="Bound">utxo</a> <a id="2769" href="Ledger.ScriptValidation.html#2769" class="Bound">tx</a> <a id="2772" class="Symbol">=</a> <a id="2774" class="Keyword">record</a>
  <a id="2783" class="Symbol">{</a> <a id="2785" href="Ledger.ScriptValidation.html#2785" class="Module">TxBody</a> <a id="2792" href="Ledger.Transaction.html#4672" class="Field">body</a>
  <a id="2799" class="Symbol">;</a> <a id="2801" href="Ledger.ScriptValidation.html#2801" class="Module">TxWitnesses</a> <a id="2813" href="Ledger.Transaction.html#4700" class="Field">wits</a>
  <a id="2820" class="Symbol">;</a> <a id="2822" href="Ledger.ScriptValidation.html#2369" class="Field">realizedInputs</a> <a id="2837" class="Symbol">=</a> <a id="2839" href="Ledger.ScriptValidation.html#2764" class="Bound">utxo</a> <a id="2844" href="Axiom.Set.Map.html#9287" class="Function Operator">∣</a> <a id="2846" href="Ledger.Transaction.html#3721" class="Function">txins</a>
  <a id="2854" class="Symbol">;</a> <a id="2856" href="Ledger.ScriptValidation.html#2428" class="Field">fee</a> <a id="2860" class="Symbol">=</a> <a id="2862" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="2869" href="Ledger.Transaction.html#3793" class="Function">txfee</a>
  <a id="2877" class="Symbol">;</a> <a id="2879" href="Ledger.ScriptValidation.html#2452" class="Field">mint</a> <a id="2884" class="Symbol">=</a> <a id="2886" href="Ledger.Transaction.html#3825" class="Function">mint</a>
  <a id="2893" class="Symbol">;</a> <a id="2895" href="Ledger.ScriptValidation.html#2570" class="Field">vkKey</a> <a id="2901" class="Symbol">=</a> <a id="2903" href="Ledger.Transaction.html#4311" class="Function">reqSigHash</a>
  <a id="2916" class="Symbol">}</a> <a id="2918" class="Keyword">where</a> <a id="2924" class="Keyword">open</a> <a id="2929" href="Ledger.Transaction.html#4647" class="Module">Tx</a> <a id="2932" href="Ledger.ScriptValidation.html#2769" class="Bound">tx</a><a id="2934" class="Symbol">;</a> <a id="2936" class="Keyword">open</a> <a id="2941" href="Ledger.Transaction.html#3692" class="Module">TxBody</a> <a id="2948" href="Ledger.Transaction.html#4672" class="Field">body</a>

<a id="DelegateOrDeReg"></a><a id="2954" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="2970" class="Symbol">:</a> <a id="2972" href="Ledger.Deleg.html#353" class="Datatype">DCert</a> <a id="2978" class="Symbol">→</a> <a id="2980" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="2984" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3000" class="Symbol">(</a><a id="3001" href="Ledger.Deleg.html#373" class="InductiveConstructor">delegate</a> <a id="3010" href="Ledger.ScriptValidation.html#3010" class="Bound">x</a> <a id="3012" href="Ledger.ScriptValidation.html#3012" class="Bound">x₁</a> <a id="3015" href="Ledger.ScriptValidation.html#3015" class="Bound">x₂</a> <a id="3018" href="Ledger.ScriptValidation.html#3018" class="Bound">x₃</a><a id="3020" class="Symbol">)</a> <a id="3022" class="Symbol">=</a> <a id="3024" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
<a id="3026" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3042" class="Symbol">(</a><a id="3043" href="Ledger.Deleg.html#449" class="InductiveConstructor">regpool</a> <a id="3051" href="Ledger.ScriptValidation.html#3051" class="Bound">x</a> <a id="3053" href="Ledger.ScriptValidation.html#3053" class="Bound">x₁</a><a id="3055" class="Symbol">)</a> <a id="3057" class="Symbol">=</a> <a id="3059" href="Data.Empty.html#886" class="Function">⊥</a>
<a id="3061" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3077" class="Symbol">(</a><a id="3078" href="Ledger.Deleg.html#497" class="InductiveConstructor">retirepool</a> <a id="3089" href="Ledger.ScriptValidation.html#3089" class="Bound">x</a> <a id="3091" href="Ledger.ScriptValidation.html#3091" class="Bound">x₁</a><a id="3093" class="Symbol">)</a> <a id="3095" class="Symbol">=</a> <a id="3097" href="Data.Empty.html#886" class="Function">⊥</a>
<a id="3099" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3115" class="Symbol">(</a><a id="3116" href="Ledger.Deleg.html#540" class="InductiveConstructor">regdrep</a> <a id="3124" href="Ledger.ScriptValidation.html#3124" class="Bound">x</a> <a id="3126" href="Ledger.ScriptValidation.html#3126" class="Bound">x₁</a> <a id="3129" href="Ledger.ScriptValidation.html#3129" class="Bound">x₂</a><a id="3131" class="Symbol">)</a> <a id="3133" class="Symbol">=</a> <a id="3135" href="Data.Empty.html#886" class="Function">⊥</a>
<a id="3137" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3153" class="Symbol">(</a><a id="3154" href="Ledger.Deleg.html#591" class="InductiveConstructor">deregdrep</a> <a id="3164" href="Ledger.ScriptValidation.html#3164" class="Bound">x</a><a id="3165" class="Symbol">)</a> <a id="3167" class="Symbol">=</a> <a id="3169" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
<a id="3171" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3187" class="Symbol">(</a><a id="3188" href="Ledger.Deleg.html#626" class="InductiveConstructor">ccreghot</a> <a id="3197" href="Ledger.ScriptValidation.html#3197" class="Bound">x</a> <a id="3199" href="Ledger.ScriptValidation.html#3199" class="Bound">x₁</a><a id="3201" class="Symbol">)</a> <a id="3203" class="Symbol">=</a> <a id="3205" href="Data.Empty.html#886" class="Function">⊥</a>

<a id="DelegateOrDeReg?"></a><a id="3208" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3225" class="Symbol">:</a> <a id="3227" class="Symbol">∀</a> <a id="3229" href="Ledger.ScriptValidation.html#3229" class="Bound">x</a> <a id="3231" class="Symbol">→</a> <a id="3233" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="3237" class="Symbol">(</a><a id="3238" href="Ledger.ScriptValidation.html#2954" class="Function">DelegateOrDeReg</a> <a id="3254" href="Ledger.ScriptValidation.html#3229" class="Bound">x</a><a id="3255" class="Symbol">)</a>
<a id="3257" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3274" class="Symbol">(</a><a id="3275" href="Ledger.Deleg.html#373" class="InductiveConstructor">delegate</a> <a id="3284" href="Ledger.ScriptValidation.html#3284" class="Bound">x</a> <a id="3286" href="Ledger.ScriptValidation.html#3286" class="Bound">x₁</a> <a id="3289" href="Ledger.ScriptValidation.html#3289" class="Bound">x₂</a> <a id="3292" href="Ledger.ScriptValidation.html#3292" class="Bound">x₃</a><a id="3294" class="Symbol">)</a> <a id="3296" class="Symbol">=</a> <a id="3298" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="3302" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a>
<a id="3305" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3322" class="Symbol">(</a><a id="3323" href="Ledger.Deleg.html#449" class="InductiveConstructor">regpool</a> <a id="3331" href="Ledger.ScriptValidation.html#3331" class="Bound">x</a> <a id="3333" href="Ledger.ScriptValidation.html#3333" class="Bound">x₁</a><a id="3335" class="Symbol">)</a> <a id="3337" class="Symbol">=</a> <a id="3339" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="3342" class="Symbol">λ</a> <a id="3344" class="Symbol">()</a>
<a id="3347" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3364" class="Symbol">(</a><a id="3365" href="Ledger.Deleg.html#497" class="InductiveConstructor">retirepool</a> <a id="3376" href="Ledger.ScriptValidation.html#3376" class="Bound">x</a> <a id="3378" href="Ledger.ScriptValidation.html#3378" class="Bound">x₁</a><a id="3380" class="Symbol">)</a> <a id="3382" class="Symbol">=</a> <a id="3384" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="3387" class="Symbol">λ</a> <a id="3389" class="Symbol">()</a>
<a id="3392" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3409" class="Symbol">(</a><a id="3410" href="Ledger.Deleg.html#540" class="InductiveConstructor">regdrep</a> <a id="3418" href="Ledger.ScriptValidation.html#3418" class="Bound">x</a> <a id="3420" href="Ledger.ScriptValidation.html#3420" class="Bound">x₁</a> <a id="3423" href="Ledger.ScriptValidation.html#3423" class="Bound">x₂</a><a id="3425" class="Symbol">)</a> <a id="3427" class="Symbol">=</a> <a id="3429" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="3432" class="Symbol">λ</a> <a id="3434" class="Symbol">()</a>
<a id="3437" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3454" class="Symbol">(</a><a id="3455" href="Ledger.Deleg.html#591" class="InductiveConstructor">deregdrep</a> <a id="3465" href="Ledger.ScriptValidation.html#3465" class="Bound">x</a><a id="3466" class="Symbol">)</a> <a id="3468" class="Symbol">=</a> <a id="3470" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="3474" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a>
<a id="3477" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="3494" class="Symbol">(</a><a id="3495" href="Ledger.Deleg.html#626" class="InductiveConstructor">ccreghot</a> <a id="3504" href="Ledger.ScriptValidation.html#3504" class="Bound">x</a> <a id="3506" href="Ledger.ScriptValidation.html#3506" class="Bound">x₁</a><a id="3508" class="Symbol">)</a> <a id="3510" class="Symbol">=</a> <a id="3512" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="3515" class="Symbol">λ</a> <a id="3517" class="Symbol">()</a>

<a id="UTxOSH"></a><a id="3521" href="Ledger.ScriptValidation.html#3521" class="Function">UTxOSH</a>  <a id="3529" class="Symbol">=</a> <a id="3531" href="Ledger.Transaction.html#3226" class="Function">TxIn</a> <a id="3536" href="Ledger.Set.Theory.html#1522" class="Function Operator">⇀</a> <a id="3538" class="Symbol">(</a><a id="3539" href="Ledger.Transaction.html#3246" class="Function">TxOut</a> <a id="3545" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3547" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="3557" class="Symbol">)</a>

<a id="scriptOutWithHash"></a><a id="3560" href="Ledger.ScriptValidation.html#3560" class="Function">scriptOutWithHash</a> <a id="3578" class="Symbol">:</a> <a id="3580" href="Ledger.Transaction.html#3226" class="Function">TxIn</a> <a id="3585" class="Symbol">→</a> <a id="3587" href="Ledger.Transaction.html#3246" class="Function">TxOut</a> <a id="3593" class="Symbol">→</a> <a id="3595" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3601" class="Symbol">(</a><a id="3602" href="Ledger.Transaction.html#3246" class="Function">TxOut</a> <a id="3608" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3610" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="3620" class="Symbol">)</a>
<a id="3622" href="Ledger.ScriptValidation.html#3560" class="Function">scriptOutWithHash</a> <a id="3640" href="Ledger.ScriptValidation.html#3640" class="Bound">txin</a> <a id="3645" class="Symbol">(</a><a id="3646" href="Ledger.ScriptValidation.html#3646" class="Bound">addr</a> <a id="3651" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3653" href="Ledger.ScriptValidation.html#3653" class="Bound">r</a><a id="3654" class="Symbol">)</a> <a id="3656" class="Keyword">with</a> <a id="3661" href="Ledger.Address.html#2758" class="Function">isScriptAddr?</a> <a id="3675" href="Ledger.ScriptValidation.html#3646" class="Bound">addr</a>
<a id="3680" class="Symbol">...</a> <a id="3684" class="Symbol">|</a> <a id="3686" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="3689" href="Ledger.ScriptValidation.html#3689" class="Bound">¬p</a> <a id="3692" class="Symbol">=</a> <a id="3694" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="3702" class="Symbol">...</a> <a id="3706" class="Symbol">|</a> <a id="3708" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="3712" href="Ledger.ScriptValidation.html#3712" class="Bound">p</a> <a id="3714" class="Symbol">=</a> <a id="3716" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3721" class="Symbol">((</a><a id="3723" class="Bound">addr</a> <a id="3728" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3730" class="Bound">r</a><a id="3731" class="Symbol">)</a> <a id="3733" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3735" href="Ledger.Address.html#2933" class="Function">getScriptHash</a> <a id="3749" class="Bound">addr</a> <a id="3754" href="Ledger.ScriptValidation.html#3712" class="Bound">p</a><a id="3755" class="Symbol">)</a>

<a id="scriptOutsWithHash"></a><a id="3758" href="Ledger.ScriptValidation.html#3758" class="Function">scriptOutsWithHash</a> <a id="3777" class="Symbol">:</a> <a id="3779" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="3784" class="Symbol">→</a> <a id="3786" href="Ledger.ScriptValidation.html#3521" class="Function">UTxOSH</a>
<a id="3793" href="Ledger.ScriptValidation.html#3758" class="Function">scriptOutsWithHash</a> <a id="3812" href="Ledger.ScriptValidation.html#3812" class="Bound">utxo</a> <a id="3817" class="Symbol">=</a> <a id="3819" href="Axiom.Set.Map.html#9036" class="Function">mapMaybeWithKeyᵐ</a> <a id="3836" href="Ledger.ScriptValidation.html#3560" class="Function">scriptOutWithHash</a> <a id="3854" href="Ledger.ScriptValidation.html#3812" class="Bound">utxo</a>

<a id="spendScripts"></a><a id="3860" href="Ledger.ScriptValidation.html#3860" class="Function">spendScripts</a> <a id="3873" class="Symbol">:</a> <a id="3875" href="Ledger.Transaction.html#3226" class="Function">TxIn</a> <a id="3880" class="Symbol">→</a> <a id="3882" href="Ledger.ScriptValidation.html#3521" class="Function">UTxOSH</a> <a id="3889" class="Symbol">→</a> <a id="3891" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3897" class="Symbol">(</a><a id="3898" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="3912" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3914" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="3924" class="Symbol">)</a>
<a id="3926" href="Ledger.ScriptValidation.html#3860" class="Function">spendScripts</a> <a id="3939" href="Ledger.ScriptValidation.html#3939" class="Bound">txin</a> <a id="3944" href="Ledger.ScriptValidation.html#3944" class="Bound">utxo</a> <a id="3949" class="Keyword">with</a> <a id="3954" href="Ledger.ScriptValidation.html#3939" class="Bound">txin</a> <a id="3959" href="Axiom.Set.html#10312" class="Function Operator">∈?</a> <a id="3962" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="3966" class="Symbol">(</a><a id="3967" href="Ledger.ScriptValidation.html#3944" class="Bound">utxo</a> <a id="3972" href="Axiom.Set.Map.html#2338" class="Function Operator">ˢ</a><a id="3973" class="Symbol">)</a>
<a id="3975" class="Symbol">...</a> <a id="3979" class="Symbol">|</a> <a id="3981" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="3984" href="Ledger.ScriptValidation.html#3984" class="Bound">¬p</a> <a id="3987" class="Symbol">=</a> <a id="3989" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="3997" class="Symbol">...</a> <a id="4001" class="Symbol">|</a> <a id="4003" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="4007" href="Ledger.ScriptValidation.html#4007" class="Bound">p</a> <a id="4009" class="Symbol">=</a> <a id="4011" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4016" class="Symbol">(</a><a id="4017" href="Ledger.ScriptValidation.html#1129" class="InductiveConstructor">Spend</a> <a id="4023" class="Bound">txin</a> <a id="4028" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4030" href="Data.Product.Base.html#622" class="Field">proj₂</a> <a id="4036" class="Symbol">(</a><a id="4037" href="Axiom.Set.Map.html#10936" class="Function">lookupᵐ</a> <a id="4045" class="Bound">utxo</a> <a id="4050" class="Bound">txin</a><a id="4054" class="Symbol">))</a>

<a id="rwdScripts"></a><a id="4058" href="Ledger.ScriptValidation.html#4058" class="Function">rwdScripts</a> <a id="4069" class="Symbol">:</a> <a id="4071" href="Ledger.Address.html#1216" class="Record">RwdAddr</a> <a id="4079" class="Symbol">→</a> <a id="4081" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4087" class="Symbol">(</a><a id="4088" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="4102" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="4104" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="4114" class="Symbol">)</a>
<a id="4116" href="Ledger.ScriptValidation.html#4058" class="Function">rwdScripts</a> <a id="4127" href="Ledger.ScriptValidation.html#4127" class="Bound">a</a> <a id="4129" class="Keyword">with</a> <a id="4134" href="Ledger.Address.html#2838" class="Function">isScriptRwdAddr?</a> <a id="4151" href="Ledger.ScriptValidation.html#4127" class="Bound">a</a>
<a id="4153" class="Symbol">...</a> <a id="4157" class="Symbol">|</a> <a id="4159" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="4162" href="Ledger.ScriptValidation.html#4162" class="Bound">¬p</a> <a id="4165" class="Symbol">=</a> <a id="4167" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="4175" class="Symbol">...</a> <a id="4179" class="Symbol">|</a> <a id="4181" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="4185" class="Symbol">(</a><a id="4186" href="Ledger.Address.html#904" class="InductiveConstructor">SHisScript</a> <a id="4197" href="Ledger.ScriptValidation.html#4197" class="Bound">sh</a><a id="4199" class="Symbol">)</a> <a id="4201" class="Symbol">=</a> <a id="4203" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4208" class="Symbol">(</a><a id="4209" href="Ledger.ScriptValidation.html#1055" class="InductiveConstructor">Rwrd</a> <a id="4214" class="Bound">a</a> <a id="4216" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4218" href="Ledger.ScriptValidation.html#4197" class="Bound">sh</a><a id="4220" class="Symbol">)</a>

<a id="certScripts"></a><a id="4223" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4235" class="Symbol">:</a> <a id="4237" href="Ledger.Deleg.html#353" class="Datatype">DCert</a> <a id="4243" class="Symbol">→</a> <a id="4245" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4251" class="Symbol">(</a><a id="4252" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="4266" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="4268" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="4278" class="Symbol">)</a>
<a id="4280" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4292" href="Ledger.ScriptValidation.html#4292" class="Bound">d</a> <a id="4294" class="Keyword">with</a> <a id="4299" href="Ledger.ScriptValidation.html#3208" class="Function">DelegateOrDeReg?</a> <a id="4316" href="Ledger.ScriptValidation.html#4292" class="Bound">d</a>
<a id="4318" class="Symbol">...</a> <a id="4322" class="Symbol">|</a> <a id="4324" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="4327" href="Ledger.ScriptValidation.html#4327" class="Bound">¬p</a> <a id="4330" class="Symbol">=</a> <a id="4332" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="4340" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4352" class="Symbol">(</a><a id="4353" href="Ledger.Deleg.html#373" class="InductiveConstructor">delegate</a>  <a id="4363" class="Symbol">(</a><a id="4364" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="4369" href="Ledger.ScriptValidation.html#4369" class="Bound">x</a><a id="4370" class="Symbol">)</a> <a id="4372" href="Ledger.ScriptValidation.html#4372" class="Bound">x₁</a> <a id="4375" href="Ledger.ScriptValidation.html#4375" class="Bound">x₂</a> <a id="4378" href="Ledger.ScriptValidation.html#4378" class="Bound">x₃</a><a id="4380" class="Symbol">)</a> <a id="4382" class="Symbol">|</a> <a id="4384" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="4388" href="Ledger.ScriptValidation.html#4388" class="Bound">p</a> <a id="4390" class="Symbol">=</a> <a id="4392" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="4400" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4412" class="Symbol">(</a><a id="4413" href="Ledger.Deleg.html#373" class="InductiveConstructor">delegate</a>  <a id="4423" class="Symbol">(</a><a id="4424" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="4429" href="Ledger.ScriptValidation.html#4429" class="Bound">y</a><a id="4430" class="Symbol">)</a> <a id="4432" href="Ledger.ScriptValidation.html#4432" class="Bound">x₁</a> <a id="4435" href="Ledger.ScriptValidation.html#4435" class="Bound">x₂</a> <a id="4438" href="Ledger.ScriptValidation.html#4438" class="Bound">x₃</a><a id="4440" class="Symbol">)</a> <a id="4442" class="Symbol">|</a> <a id="4444" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="4448" href="Ledger.ScriptValidation.html#4448" class="Bound">p</a> <a id="4450" class="Symbol">=</a> <a id="4452" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4457" class="Symbol">(</a><a id="4458" href="Ledger.ScriptValidation.html#1018" class="InductiveConstructor">Cert</a> <a id="4463" class="Symbol">(</a><a id="4464" href="Ledger.Deleg.html#373" class="InductiveConstructor">delegate</a> <a id="4473" class="Symbol">(</a><a id="4474" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="4479" href="Ledger.ScriptValidation.html#4429" class="Bound">y</a><a id="4480" class="Symbol">)</a> <a id="4482" href="Ledger.ScriptValidation.html#4432" class="Bound">x₁</a> <a id="4485" href="Ledger.ScriptValidation.html#4435" class="Bound">x₂</a> <a id="4488" href="Ledger.ScriptValidation.html#4438" class="Bound">x₃</a><a id="4490" class="Symbol">)</a> <a id="4492" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4494" href="Ledger.ScriptValidation.html#4429" class="Bound">y</a><a id="4495" class="Symbol">)</a>
<a id="4497" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4509" class="Symbol">(</a><a id="4510" href="Ledger.Deleg.html#591" class="InductiveConstructor">deregdrep</a> <a id="4520" class="Symbol">(</a><a id="4521" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="4526" href="Ledger.ScriptValidation.html#4526" class="Bound">x</a><a id="4527" class="Symbol">))</a>          <a id="4539" class="Symbol">|</a> <a id="4541" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="4545" href="Ledger.ScriptValidation.html#4545" class="Bound">p</a> <a id="4547" class="Symbol">=</a> <a id="4549" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="4557" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4569" class="Symbol">(</a><a id="4570" href="Ledger.Deleg.html#591" class="InductiveConstructor">deregdrep</a> <a id="4580" class="Symbol">(</a><a id="4581" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="4586" href="Ledger.ScriptValidation.html#4586" class="Bound">y</a><a id="4587" class="Symbol">))</a>          <a id="4599" class="Symbol">|</a> <a id="4601" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="4605" href="Ledger.ScriptValidation.html#4605" class="Bound">p</a> <a id="4607" class="Symbol">=</a> <a id="4609" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4614" class="Symbol">(</a><a id="4615" href="Ledger.ScriptValidation.html#1018" class="InductiveConstructor">Cert</a> <a id="4620" class="Symbol">(</a><a id="4621" href="Ledger.Deleg.html#591" class="InductiveConstructor">deregdrep</a> <a id="4631" class="Symbol">(</a><a id="4632" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="4637" href="Ledger.ScriptValidation.html#4586" class="Bound">y</a><a id="4638" class="Symbol">))</a> <a id="4641" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4643" href="Ledger.ScriptValidation.html#4586" class="Bound">y</a><a id="4644" class="Symbol">)</a>

<a id="scriptsNeeded"></a><a id="4647" href="Ledger.ScriptValidation.html#4647" class="Function">scriptsNeeded</a> <a id="4661" class="Symbol">:</a> <a id="4663" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="4668" class="Symbol">→</a> <a id="4670" href="Ledger.Transaction.html#3692" class="Record">TxBody</a> <a id="4677" class="Symbol">→</a> <a id="4679" href="Ledger.Set.Theory.html#412" class="Function Operator">ℙ</a> <a id="4681" class="Symbol">(</a><a id="4682" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="4696" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="4698" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="4708" class="Symbol">)</a>
<a id="4710" href="Ledger.ScriptValidation.html#4647" class="Function">scriptsNeeded</a> <a id="4724" href="Ledger.ScriptValidation.html#4724" class="Bound">utxo</a> <a id="4729" href="Ledger.ScriptValidation.html#4729" class="Bound">txb</a>
  <a id="4735" class="Symbol">=</a> <a id="4737" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="4748" class="Symbol">(λ</a> <a id="4751" href="Ledger.ScriptValidation.html#4751" class="Bound">x</a> <a id="4753" class="Symbol">→</a> <a id="4755" href="Ledger.ScriptValidation.html#3860" class="Function">spendScripts</a> <a id="4768" href="Ledger.ScriptValidation.html#4751" class="Bound">x</a> <a id="4770" class="Symbol">(</a><a id="4771" href="Ledger.ScriptValidation.html#3758" class="Function">scriptOutsWithHash</a> <a id="4790" href="Ledger.ScriptValidation.html#4724" class="Bound">utxo</a><a id="4794" class="Symbol">))</a> <a id="4797" href="Ledger.Transaction.html#3721" class="Field">txins</a>
  <a id="4805" href="Axiom.Set.html#8720" class="Function Operator">∪</a> <a id="4807" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="4818" class="Symbol">(λ</a> <a id="4821" href="Ledger.ScriptValidation.html#4821" class="Bound">x</a> <a id="4823" class="Symbol">→</a> <a id="4825" href="Ledger.ScriptValidation.html#4058" class="Function">rwdScripts</a> <a id="4836" href="Ledger.ScriptValidation.html#4821" class="Bound">x</a><a id="4837" class="Symbol">)</a> <a id="4839" class="Symbol">(</a><a id="4840" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="4844" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="4846" href="Ledger.Transaction.html#3947" class="Field">txwdrls</a> <a id="4854" class="Symbol">.</a><a id="4855" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="4860" class="Symbol">)</a>
  <a id="4864" href="Axiom.Set.html#8720" class="Function Operator">∪</a> <a id="4866" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="4877" class="Symbol">(λ</a> <a id="4880" href="Ledger.ScriptValidation.html#4880" class="Bound">x</a> <a id="4882" class="Symbol">→</a> <a id="4884" href="Ledger.ScriptValidation.html#4223" class="Function">certScripts</a> <a id="4896" href="Ledger.ScriptValidation.html#4880" class="Bound">x</a><a id="4897" class="Symbol">)</a> <a id="4899" class="Symbol">(</a><a id="4900" href="Axiom.Set.html#5489" class="Function">fromList</a> <a id="4909" href="Ledger.Transaction.html#3909" class="Field">txcerts</a><a id="4916" class="Symbol">)</a>
  <a id="4920" href="Axiom.Set.html#8720" class="Function Operator">∪</a> <a id="4922" href="Ledger.Set.Theory.html#442" class="Function">mapˢ</a> <a id="4927" class="Symbol">(λ</a> <a id="4930" href="Ledger.ScriptValidation.html#4930" class="Bound">x</a> <a id="4932" class="Symbol">→</a> <a id="4934" href="Ledger.ScriptValidation.html#1092" class="InductiveConstructor">Mint</a> <a id="4939" href="Ledger.ScriptValidation.html#4930" class="Bound">x</a> <a id="4941" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4943" href="Ledger.ScriptValidation.html#4930" class="Bound">x</a><a id="4944" class="Symbol">)</a> <a id="4946" class="Symbol">(</a><a id="4947" href="Ledger.TokenAlgebra.html#1024" class="Function">policies</a> <a id="4956" href="Ledger.Transaction.html#3825" class="Field">mint</a><a id="4960" class="Symbol">)</a>
  <a id="4964" class="Keyword">where</a> <a id="4970" class="Keyword">open</a> <a id="4975" href="Ledger.Transaction.html#3692" class="Module">TxBody</a> <a id="4982" href="Ledger.ScriptValidation.html#4729" class="Bound">txb</a>


<a id="4988" class="Comment">-- We need to add toData to define this</a>
<a id="valContext"></a><a id="5028" href="Ledger.ScriptValidation.html#5028" class="Function">valContext</a> <a id="5039" class="Symbol">:</a> <a id="5041" href="Ledger.ScriptValidation.html#2342" class="Record">TxInfo</a> <a id="5048" class="Symbol">→</a> <a id="5050" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="5064" class="Symbol">→</a> <a id="5066" href="Ledger.Script.html#1978" class="Function">Data</a>
<a id="5071" href="Ledger.ScriptValidation.html#5028" class="Function">valContext</a> <a id="5082" href="Ledger.ScriptValidation.html#5082" class="Bound">txinfo</a> <a id="5089" href="Ledger.ScriptValidation.html#5089" class="Bound">sp</a> <a id="5092" class="Symbol">=</a> <a id="5094" href="Ledger.Script.html#2286" class="Function">toData</a> <a id="5101" class="Symbol">(</a><a id="5102" href="Ledger.ScriptValidation.html#5082" class="Bound">txinfo</a> <a id="5109" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5111" href="Ledger.ScriptValidation.html#5089" class="Bound">sp</a><a id="5113" class="Symbol">)</a>


<a id="5117" class="Comment">-- need to get map from language script ↦ cm</a>
<a id="5162" class="Comment">-- need to update costmodels to add the language map in order to check</a>
<a id="5233" class="Comment">-- (Language ↦ CostModel) ∈ costmdls ↦ (Language ↦ CostModel)</a>

<a id="collectPhaseTwoScriptInputs&#39;"></a><a id="5296" href="Ledger.ScriptValidation.html#5296" class="Function">collectPhaseTwoScriptInputs&#39;</a> <a id="5325" class="Symbol">:</a> <a id="5327" href="Ledger.PParams.html#1143" class="Record">PParams</a> <a id="5335" class="Symbol">→</a> <a id="5337" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="5340" class="Symbol">→</a> <a id="5342" href="Ledger.Transaction.html#3286" class="Function">UTxO</a> <a id="5347" class="Symbol">→</a> <a id="5349" class="Symbol">(</a><a id="5350" href="Ledger.ScriptValidation.html#990" class="Datatype">ScriptPurpose</a> <a id="5364" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5366" href="Ledger.Crypto.html#1595" class="Function">ScriptHash</a><a id="5376" class="Symbol">)</a>
  <a id="5380" class="Symbol">→</a> <a id="5382" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5388" class="Symbol">(</a><a id="5389" href="Ledger.Script.html#2808" class="Function">Script</a> <a id="5396" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5398" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5403" href="Ledger.Script.html#1978" class="Function">Data</a> <a id="5408" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5410" href="Ledger.Script.html#1554" class="Function">ExUnits</a> <a id="5418" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5420" href="Ledger.Script.html#1111" class="Function">CostModel</a><a id="5429" class="Symbol">)</a>
<a id="5431" href="Ledger.ScriptValidation.html#5296" class="Function">collectPhaseTwoScriptInputs&#39;</a> <a id="5460" href="Ledger.ScriptValidation.html#5460" class="Bound">pp</a> <a id="5463" href="Ledger.ScriptValidation.html#5463" class="Bound">tx</a> <a id="5466" href="Ledger.ScriptValidation.html#5466" class="Bound">utxo</a> <a id="5471" class="Symbol">(</a><a id="5472" href="Ledger.ScriptValidation.html#5472" class="Bound">sp</a> <a id="5475" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5477" href="Ledger.ScriptValidation.html#5477" class="Bound">sh</a><a id="5479" class="Symbol">)</a>
  <a id="5483" class="Keyword">with</a> <a id="5488" href="Ledger.Transaction.html#5434" class="Function">lookupScriptHash</a> <a id="5505" href="Ledger.ScriptValidation.html#5477" class="Bound">sh</a> <a id="5508" href="Ledger.ScriptValidation.html#5463" class="Bound">tx</a>
<a id="5511" class="Symbol">...</a> <a id="5515" class="Symbol">|</a> <a id="5517" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="5525" class="Symbol">=</a> <a id="5527" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="5535" class="Symbol">...</a> <a id="5539" class="Symbol">|</a> <a id="5541" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5546" href="Ledger.ScriptValidation.html#5546" class="Bound">s</a>
  <a id="5550" class="Keyword">with</a> <a id="5555" href="Data.Sum.html#1047" class="Function">isInj₂</a> <a id="5562" href="Ledger.ScriptValidation.html#5546" class="Bound">s</a> <a id="5564" class="Symbol">|</a> <a id="5566" href="Ledger.ScriptValidation.html#1498" class="Function">indexedRdmrs</a> <a id="5579" class="Bound">tx</a> <a id="5582" class="Bound">sp</a>
<a id="5585" class="Symbol">...</a> <a id="5589" class="Symbol">|</a> <a id="5591" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5596" href="Ledger.ScriptValidation.html#5596" class="Bound">p2s</a> <a id="5600" class="Symbol">|</a> <a id="5602" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5607" class="Symbol">(</a><a id="5608" href="Ledger.ScriptValidation.html#5608" class="Bound">rdmr</a> <a id="5613" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5615" href="Ledger.ScriptValidation.html#5615" class="Bound">eu</a><a id="5617" class="Symbol">)</a>
    <a id="5623" class="Symbol">=</a> <a id="5625" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5630" class="Symbol">(</a><a id="5631" class="Bound">s</a> <a id="5633" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a>
        <a id="5643" class="Symbol">(</a> <a id="5645" class="Symbol">(</a><a id="5646" href="Ledger.ScriptValidation.html#2000" class="Function">getDatum</a> <a id="5655" class="Bound">tx</a> <a id="5658" class="Bound">utxo</a> <a id="5663" class="Bound">sp</a> <a id="5666" href="Data.List.Base.html#1929" class="Function Operator">++</a> <a id="5669" href="Ledger.ScriptValidation.html#5608" class="Bound">rdmr</a> <a id="5674" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5676" href="Ledger.ScriptValidation.html#5028" class="Function">valContext</a> <a id="5687" class="Symbol">(</a><a id="5688" href="Ledger.ScriptValidation.html#2649" class="Function">txInfo</a> <a id="5695" class="Symbol">(</a><a id="5696" href="Ledger.Script.html#2243" class="Function">language</a> <a id="5705" href="Ledger.ScriptValidation.html#5596" class="Bound">p2s</a><a id="5708" class="Symbol">)</a> <a id="5710" class="Bound">pp</a> <a id="5713" class="Bound">utxo</a> <a id="5718" class="Bound">tx</a><a id="5720" class="Symbol">)</a> <a id="5722" class="Bound">sp</a> <a id="5725" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5727" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="5729" class="Symbol">)</a>
        <a id="5739" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5741" href="Ledger.ScriptValidation.html#5615" class="Bound">eu</a>
        <a id="5752" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5754" href="Ledger.PParams.html#2465" class="Field">PParams.costmdls</a> <a id="5771" class="Bound">pp</a><a id="5773" class="Symbol">)</a>
      <a id="5781" class="Symbol">)</a>
<a id="5783" class="CatchallClause Symbol">...</a><a id="5786" class="CatchallClause"> </a><a id="5787" class="CatchallClause Symbol">|</a><a id="5788" class="CatchallClause"> </a><a id="5789" href="Ledger.ScriptValidation.html#5789" class="CatchallClause Bound">x</a><a id="5790" class="CatchallClause"> </a><a id="5791" class="CatchallClause Symbol">|</a><a id="5792" class="CatchallClause"> </a><a id="5793" href="Ledger.ScriptValidation.html#5793" class="CatchallClause Bound">y</a> <a id="5795" class="Symbol">=</a> <a id="5797" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

<a id="collectPhaseTwoScriptInputs"></a><a id="5806" href="Ledger.ScriptValidation.html#5806" class="Function">collectPhaseTwoScriptInputs</a> <a id="5834" class="Symbol">:</a> <a id="5836" href="Ledger.PParams.html#1143" class="Record">PParams</a> <a id="5844" class="Symbol">→</a> <a id="5846" href="Ledger.Transaction.html#4647" class="Record">Tx</a> <a id="5849" class="Symbol">→</a> <a id="5851" href="Ledger.Transaction.html#3286" class="Function">UTxO</a>
  <a id="5858" class="Symbol">→</a> <a id="5860" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5865" class="Symbol">(</a><a id="5866" href="Ledger.Script.html#2808" class="Function">Script</a> <a id="5873" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5875" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5880" href="Ledger.Script.html#1978" class="Function">Data</a> <a id="5885" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5887" href="Ledger.Script.html#1554" class="Function">ExUnits</a> <a id="5895" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5897" href="Ledger.Script.html#1111" class="Function">CostModel</a><a id="5906" class="Symbol">)</a>
<a id="5908" href="Ledger.ScriptValidation.html#5806" class="Function">collectPhaseTwoScriptInputs</a> <a id="5936" href="Ledger.ScriptValidation.html#5936" class="Bound">pp</a> <a id="5939" href="Ledger.ScriptValidation.html#5939" class="Bound">tx</a> <a id="5942" href="Ledger.ScriptValidation.html#5942" class="Bound">utxo</a>
  <a id="5949" class="Symbol">=</a> <a id="5951" href="Ledger.Set.Theory.html#1235" class="Function">setToList</a>
  <a id="5963" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="5965" href="Axiom.Set.html#7573" class="Function">mapPartial</a> <a id="5976" class="Symbol">(</a><a id="5977" href="Ledger.ScriptValidation.html#5296" class="Function">collectPhaseTwoScriptInputs&#39;</a> <a id="6006" href="Ledger.ScriptValidation.html#5936" class="Bound">pp</a> <a id="6009" href="Ledger.ScriptValidation.html#5939" class="Bound">tx</a> <a id="6012" href="Ledger.ScriptValidation.html#5942" class="Bound">utxo</a><a id="6016" class="Symbol">)</a>
  <a id="6020" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6022" href="Ledger.ScriptValidation.html#4647" class="Function">scriptsNeeded</a> <a id="6036" href="Ledger.ScriptValidation.html#5942" class="Bound">utxo</a> <a id="6041" class="Symbol">(</a><a id="6042" href="Ledger.ScriptValidation.html#5939" class="Bound">tx</a> <a id="6045" class="Symbol">.</a><a id="6046" href="Ledger.Transaction.html#4672" class="Field">Tx.body</a><a id="6053" class="Symbol">)</a>
</pre></body></html>